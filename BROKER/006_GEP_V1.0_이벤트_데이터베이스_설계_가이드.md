# GEP V1.0 이벤트 데이터베이스 설계 가이드

## 1. 시스템 개요

### 1.1 핵심 기능
- **등록 기능**: 사용자 등록 및 초기화
- **문제풀이 기능**: 과목별 연속 문제풀이
- **통계 기능**: 금일통계 및 누적통계

### 1.2 데이터 요구사항
- **등록시점 기록**: 사용자 등록 정보
- **문제풀이 기록**: 클릭한 문제번호와 정답여부
- **정답률 기록**: 맞춘 횟수와 틀린 횟수
- **실시간 기록**: 중앙아키텍처 기반 실시간 업데이트

## 2. EVENT_DB 필드 구조 설계

### 2.1 기본 필드 구조

| 필드명 | 타입 | 설명 | 예시 |
|--------|------|------|------|
| EVENT_ID | VARCHAR(20) | 이벤트 고유 ID | EVT_20241219_001 |
| USER_ID | VARCHAR(20) | 사용자 ID | guest_001 / user_001 |
| USER_TYPE | VARCHAR(10) | 사용자 타입 | guest / registered |
| EVENT_TYPE | VARCHAR(20) | 이벤트 타입 | registration / question_solve / statistics_view |
| TIMESTAMP | DATETIME | 이벤트 발생 시간 | 2024-12-19 14:30:25 |
| SESSION_ID | VARCHAR(30) | 세션 ID | SESS_20241219_143025 |

### 2.2 등록 이벤트 필드

| 필드명 | 타입 | 설명 | 예시 |
|--------|------|------|------|
| REGISTRATION_DATE | DATE | 등록일 | 2024-12-19 |
| EXAM_DATE | DATE | 시험일 | 2025-09-13 |
| USER_NAME | VARCHAR(50) | 사용자명 | 조대표 |
| INITIAL_SETTINGS | JSON | 초기 설정 | {"theme": "dark", "sound": "on"} |

### 2.3 문제풀이 이벤트 필드

| 필드명 | 타입 | 설명 | 예시 |
|--------|------|------|------|
| QCODE | VARCHAR(20) | 문제 코드 | ABAA-01 |
| ETITLE | VARCHAR(20) | 시험 종류 | 보험중개사 |
| ECLASS | VARCHAR(20) | 중분류 | 손해보험 |
| LAYER1 | VARCHAR(20) | 과목 | 관계법령 |
| EROUND | INT | 회차 | 20 |
| QNUM | INT | 문제번호 | 1 |
| USER_ANSWER | VARCHAR(10) | 사용자 답안 | 2 |
| CORRECT_ANSWER | VARCHAR(10) | 정답 | 2 |
| IS_CORRECT | BOOLEAN | 정답여부 | true |
| SOLVE_TIME | INT | 풀이시간(초) | 45 |
| DIFFICULTY_RATING | INT | 난이도 평가 | 3 |

### 2.4 통계 이벤트 필드

| 필드명 | 타입 | 설명 | 예시 |
|--------|------|------|------|
| STATS_TYPE | VARCHAR(20) | 통계 타입 | daily / cumulative |
| SUBJECT | VARCHAR(20) | 과목 | 관계법령 |
| TOTAL_QUESTIONS | INT | 총 문제수 | 40 |
| CORRECT_COUNT | INT | 정답수 | 32 |
| INCORRECT_COUNT | INT | 오답수 | 8 |
| ACCURACY_RATE | DECIMAL(5,2) | 정답률 | 80.00 |
| STUDY_TIME | INT | 학습시간(분) | 120 |

### 2.5 오답 분석 필드

| 필드명 | 타입 | 설명 | 예시 |
|--------|------|------|------|
| ERROR_COUNT | INT | 틀린 횟수 | 3 |
| ERROR_PATTERN | JSON | 오답 패턴 | {"1번": 2, "3번": 1} |
| LAST_ERROR_DATE | DATE | 마지막 오답일 | 2024-12-19 |
| DIFFICULTY_LEVEL | VARCHAR(10) | 난이도 레벨 | high |

## 3. 중앙아키텍처 연계 방안

### 3.1 데이터 플로우

```
사용자 액션 → 중앙아키텍처 → EVENT_DB 기록 → 통계 업데이트
```

### 3.2 중앙아키텍처 연동 구조

```javascript
// 중앙 데이터 매니저
class CentralDataManager {
    // 이벤트 기록
    recordEvent(eventData) {
        // EVENT_DB에 실시간 기록
        this.saveToEventDB(eventData);
        
        // 통계 업데이트
        this.updateStatistics(eventData);
        
        // LocalStorage 동기화
        this.syncToLocalStorage();
    }
    
    // 문제풀이 기록
    recordQuestionSolve(qcode, userAnswer, isCorrect) {
        const eventData = {
            EVENT_TYPE: 'question_solve',
            QCODE: qcode,
            USER_ANSWER: userAnswer,
            IS_CORRECT: isCorrect,
            TIMESTAMP: new Date().toISOString()
        };
        
        this.recordEvent(eventData);
    }
}
```

### 3.3 실시간 통계 업데이트

```javascript
// 통계 매니저
class StatisticsManager {
    // 금일 통계 업데이트
    updateDailyStats() {
        const today = new Date().toDateString();
        const dailyEvents = this.getEventsByDate(today);
        
        const stats = {
            STATS_TYPE: 'daily',
            TOTAL_QUESTIONS: dailyEvents.length,
            CORRECT_COUNT: dailyEvents.filter(e => e.IS_CORRECT).length,
            ACCURACY_RATE: this.calculateAccuracy(dailyEvents)
        };
        
        this.recordEvent({
            EVENT_TYPE: 'statistics_view',
            ...stats
        });
    }
    
    // 누적 통계 업데이트
    updateCumulativeStats() {
        const allEvents = this.getAllEvents();
        const stats = {
            STATS_TYPE: 'cumulative',
            TOTAL_QUESTIONS: allEvents.length,
            CORRECT_COUNT: allEvents.filter(e => e.IS_CORRECT).length,
            ACCURACY_RATE: this.calculateAccuracy(allEvents)
        };
        
        this.recordEvent({
            EVENT_TYPE: 'statistics_view',
            ...stats
        });
    }
}
```

## 4. 활용 방안

### 4.1 금일 통계 구현

```javascript
// DAY 1 예시
// 10:00 - 10문제 풀이
// 13:00 - 30문제 풀이  
// 17:00 - 41번째 문제 표시, 금일 40문제 정답률 표시

class DailyStatsTracker {
    getTodayProgress() {
        const today = new Date().toDateString();
        const todayEvents = this.getEventsByDate(today);
        
        return {
            totalSolved: todayEvents.length,
            correctCount: todayEvents.filter(e => e.IS_CORRECT).length,
            accuracyRate: this.calculateAccuracy(todayEvents),
            nextQuestionNumber: todayEvents.length + 1
        };
    }
}
```

### 4.2 누적 통계 구현

```javascript
class CumulativeStatsTracker {
    getCumulativeStats() {
        const allEvents = this.getAllEvents();
        const registrationDate = this.getRegistrationDate();
        
        return {
            registrationDate: registrationDate,
            totalDays: this.calculateDays(registrationDate),
            totalQuestions: allEvents.length,
            correctCount: allEvents.filter(e => e.IS_CORRECT).length,
            accuracyRate: this.calculateAccuracy(allEvents)
        };
    }
}
```

### 4.3 오답 분석 구현

```javascript
class ErrorAnalysisTracker {
    getFrequentErrors() {
        const errorEvents = this.getErrorEvents();
        const errorCounts = {};
        
        errorEvents.forEach(event => {
            if (!errorCounts[event.QCODE]) {
                errorCounts[event.QCODE] = 0;
            }
            errorCounts[event.QCODE]++;
        });
        
        return {
            error5Times: Object.keys(errorCounts).filter(q => errorCounts[q] >= 5),
            error4Times: Object.keys(errorCounts).filter(q => errorCounts[q] >= 4),
            error3Times: Object.keys(errorCounts).filter(q => errorCounts[q] >= 3)
        };
    }
}
```

## 5. 데이터베이스 스키마

### 5.1 EVENT_DB 테이블 구조

```sql
CREATE TABLE EVENT_DB (
    EVENT_ID VARCHAR(20) PRIMARY KEY,
    USER_ID VARCHAR(20) NOT NULL,
    USER_TYPE VARCHAR(10) NOT NULL,
    EVENT_TYPE VARCHAR(20) NOT NULL,
    TIMESTAMP DATETIME NOT NULL,
    SESSION_ID VARCHAR(30),
    
    -- 등록 이벤트
    REGISTRATION_DATE DATE,
    EXAM_DATE DATE,
    USER_NAME VARCHAR(50),
    INITIAL_SETTINGS JSON,
    
    -- 문제풀이 이벤트
    QCODE VARCHAR(20),
    ETITLE VARCHAR(20),
    ECLASS VARCHAR(20),
    LAYER1 VARCHAR(20),
    EROUND INT,
    QNUM INT,
    USER_ANSWER VARCHAR(10),
    CORRECT_ANSWER VARCHAR(10),
    IS_CORRECT BOOLEAN,
    SOLVE_TIME INT,
    DIFFICULTY_RATING INT,
    
    -- 통계 이벤트
    STATS_TYPE VARCHAR(20),
    SUBJECT VARCHAR(20),
    TOTAL_QUESTIONS INT,
    CORRECT_COUNT INT,
    INCORRECT_COUNT INT,
    ACCURACY_RATE DECIMAL(5,2),
    STUDY_TIME INT,
    
    -- 오답 분석
    ERROR_COUNT INT,
    ERROR_PATTERN JSON,
    LAST_ERROR_DATE DATE,
    DIFFICULTY_LEVEL VARCHAR(10),
    
    INDEX idx_user_id (USER_ID),
    INDEX idx_event_type (EVENT_TYPE),
    INDEX idx_timestamp (TIMESTAMP),
    INDEX idx_qcode (QCODE)
);
```

## 6. 구현 우선순위

### 6.1 1단계: 기본 이벤트 기록
- 사용자 등록 이벤트
- 문제풀이 이벤트
- 기본 통계 이벤트

### 6.2 2단계: 통계 기능
- 금일 통계 구현
- 누적 통계 구현
- 정답률 계산

### 6.3 3단계: 고급 분석
- 오답 패턴 분석
- 난이도 평가
- 학습 추천 시스템

## 7. ACIU S4 경험 활용

### 7.1 중앙아키텍처 패턴
- CentralDataManager 활용
- LocalStorage 동기화
- 실시간 업데이트

### 7.2 통계 시스템
- 일일/누적 통계 분리
- 실시간 정답률 계산
- 오답 문제 추적

### 7.3 사용자 경험
- 게스트/등록 사용자 구분
- 세션 관리
- 학습 진행도 추적

---

**작성자**: AI Assistant (Seo Daeri)  
**작성일**: 2024-12-19  
**버전**: GEP V1.0 Event DB Design v1.0
