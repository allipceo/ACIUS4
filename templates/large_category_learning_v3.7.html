<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACIU S4 v3.7 - ëŒ€ë¶„ë¥˜ í•™ìŠµ</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- í—¤ë” -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸ¯ ëŒ€ë¶„ë¥˜ í•™ìŠµ</h1>
            <p class="text-gray-600">ì¹´í…Œê³ ë¦¬ë³„ í•™ìŠµì„ í†µí•´ ì²´ê³„ì ìœ¼ë¡œ ì¤€ë¹„í•˜ì„¸ìš”</p>
        </div>


        
        <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ -->
        <div class="max-w-4xl mx-auto mb-8">
            <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“š ì¹´í…Œê³ ë¦¬ ì„ íƒ</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- ì¬ì‚°ë³´í—˜ -->
                <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                    <div class="text-center">
                        <div class="text-4xl mb-4">ğŸ¢</div>
                        <h4 class="text-lg font-bold text-blue-800 mb-2">ì¬ì‚°ë³´í—˜</h4>
                        <p class="text-gray-600 mb-4">ì¼ë°˜ì¬ì‚°ë³´í—˜</p>
                        <div class="text-sm text-gray-500 mb-4">
                            <div>ì´ ë¬¸ì œ: <span class="font-medium">169ë¬¸ì œ</span></div>
                            <div>ì§„ë„: <span id="progress-06ì¬ì‚°ë³´í—˜">0%</span></div>
                            <div>ì •ë‹µë¥ : <span id="accuracy-06ì¬ì‚°ë³´í—˜">0%</span></div>
                        </div>
                        <button onclick="startCategoryLearning('06ì¬ì‚°ë³´í—˜')" 
                                class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                            í•™ìŠµ ì‹œì‘
                        </button>
                    </div>
                </div>
                
                <!-- íŠ¹ì¢…ë³´í—˜ -->
                <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                    <div class="text-center">
                        <div class="text-4xl mb-4">ğŸš—</div>
                        <h4 class="text-lg font-bold text-green-800 mb-2">íŠ¹ì¢…ë³´í—˜</h4>
                        <p class="text-gray-600 mb-4">ìë™ì°¨ë³´í—˜</p>
                        <div class="text-sm text-gray-500 mb-4">
                            <div>ì´ ë¬¸ì œ: <span class="font-medium">182ë¬¸ì œ</span></div>
                            <div>ì§„ë„: <span id="progress-07íŠ¹ì¢…ë³´í—˜">0%</span></div>
                            <div>ì •ë‹µë¥ : <span id="accuracy-07íŠ¹ì¢…ë³´í—˜">0%</span></div>
                        </div>
                        <button onclick="startCategoryLearning('07íŠ¹ì¢…ë³´í—˜')" 
                                class="w-full bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                            í•™ìŠµ ì‹œì‘
                        </button>
                    </div>
                </div>
                
                <!-- ë°°ìƒì±…ì„ë³´í—˜ -->
                <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                    <div class="text-center">
                        <div class="text-4xl mb-4">âš–ï¸</div>
                        <h4 class="text-lg font-bold text-yellow-800 mb-2">ë°°ìƒì±…ì„ë³´í—˜</h4>
                        <p class="text-gray-600 mb-4">ì±…ì„ë³´í—˜</p>
                        <div class="text-sm text-gray-500 mb-4">
                            <div>ì´ ë¬¸ì œ: <span class="font-medium">268ë¬¸ì œ</span></div>
                            <div>ì§„ë„: <span id="progress-08ë°°ìƒì±…ì„ë³´í—˜">0%</span></div>
                            <div>ì •ë‹µë¥ : <span id="accuracy-08ë°°ìƒì±…ì„ë³´í—˜">0%</span></div>
                        </div>
                        <button onclick="startCategoryLearning('08ë°°ìƒì±…ì„ë³´í—˜')" 
                                class="w-full bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-colors">
                            í•™ìŠµ ì‹œì‘
                        </button>
                    </div>
                </div>
                
                <!-- í•´ìƒë³´í—˜ -->
                <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                    <div class="text-center">
                        <div class="text-4xl mb-4">ğŸš¢</div>
                        <h4 class="text-lg font-bold text-purple-800 mb-2">í•´ìƒë³´í—˜</h4>
                        <p class="text-gray-600 mb-4">í•´ìƒë³´í—˜</p>
                        <div class="text-sm text-gray-500 mb-4">
                            <div>ì´ ë¬¸ì œ: <span class="font-medium">170ë¬¸ì œ</span></div>
                            <div>ì§„ë„: <span id="progress-09í•´ìƒë³´í—˜">0%</span></div>
                            <div>ì •ë‹µë¥ : <span id="accuracy-09í•´ìƒë³´í—˜">0%</span></div>
                        </div>
                        <button onclick="startCategoryLearning('09í•´ìƒë³´í—˜')" 
                                class="w-full bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-colors">
                            í•™ìŠµ ì‹œì‘
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- í•™ìŠµ í†µê³„ -->
        <div class="max-w-6xl mx-auto mb-8">
            <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“Š ì¹´í…Œê³ ë¦¬ë³„ í•™ìŠµ í†µê³„</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="category-stats">
                <!-- ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
        <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4 text-center">ğŸš€ ì•¡ì…˜</h3>
            <div class="flex flex-col md:flex-row gap-4 justify-center">
                <button onclick="resetCategoryProgress()" 
                        class="flex-1 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white px-6 py-3 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg">
                    <span class="text-lg">ğŸ“Š</span>
                    <span class="ml-2 font-semibold">ì¹´í…Œê³ ë¦¬ ì§„ë„ ì´ˆê¸°í™”</span>
                </button>
                <a href="/home" 
                   class="flex-1 bg-gradient-to-r from-gray-500 to-gray-600 hover:from-gray-600 hover:to-gray-700 text-white px-6 py-3 rounded-lg transition-all duration-300 transform hover:scale-105 shadow-lg text-center">
                    <span class="text-lg">ğŸ </span>
                    <span class="ml-2 font-semibold">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</span>
                </a>
            </div>
        </div>
    </div>

    <!-- ì¤‘ì•™ ë°ì´í„° ê´€ë¦¬ ì‹œìŠ¤í…œ -->
    <script src="/static/js/central_data_manager.js"></script>
    <script src="/static/js/compatibility_layer.js"></script>
    <script src="/static/js/quiz_data_collector.js"></script>
    <script src="/static/js/realtime_sync_manager.js"></script>
    
    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ í†µê³„ í‘œì‹œ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== ëŒ€ë¶„ë¥˜ í•™ìŠµ í˜ì´ì§€ v3.7 ë¡œë“œ ===');
            
            // ì¤‘ì•™ ë°ì´í„° ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ˆê¸°í™” í™•ì¸
            initializeCentralDataSystem();
            
            loadCategoryStatistics();
        });

        // ì¤‘ì•™ ë°ì´í„° ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
        function initializeCentralDataSystem() {
            console.log('=== ì¤‘ì•™ ë°ì´í„° ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ===');
            
            // ì¤‘ì•™ ë°ì´í„° ê´€ë¦¬ì í™•ì¸
            if (window.CentralDataManager) {
                console.log('âœ… CentralDataManager í™•ì¸ë¨');
            } else {
                console.warn('âš ï¸ CentralDataManagerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
            
            // í˜¸í™˜ì„± ë ˆì´ì–´ í™•ì¸
            if (window.CompatibilityLayer) {
                console.log('âœ… CompatibilityLayer í™•ì¸ë¨');
            } else {
                console.warn('âš ï¸ CompatibilityLayerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
            
            // ë¬¸ì œ í’€ì´ ë°ì´í„° ìˆ˜ì§‘ê¸° í™•ì¸
            if (window.QuizDataCollector) {
                console.log('âœ… QuizDataCollector í™•ì¸ë¨');
            } else {
                console.warn('âš ï¸ QuizDataCollectorë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
            
            // ì‹¤ì‹œê°„ ë™ê¸°í™” ë§¤ë‹ˆì € í™•ì¸
            if (window.RealtimeSyncManager) {
                console.log('âœ… RealtimeSyncManager í™•ì¸ë¨');
            } else {
                console.warn('âš ï¸ RealtimeSyncManagerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
            
            console.log('âœ… ì¤‘ì•™ ë°ì´í„° ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ ë¡œë“œ (98ë²ˆ ë¬¸ì„œ ê¸°ë°˜)
        function loadCategoryStatistics() {
            try {
                console.log('=== ëŒ€ë¶„ë¥˜ í•™ìŠµ í†µê³„ ë¡œë“œ ì‹œì‘ ===');
                const statsData = localStorage.getItem('aicu_statistics') || '{}';
                const stats = JSON.parse(statsData);
                
                // 4ê°œ ì¹´í…Œê³ ë¦¬ë§Œ ì²˜ë¦¬ (JSON íŒŒì¼ ê¸°ì¤€)
                const categories = ['06ì¬ì‚°ë³´í—˜', '07íŠ¹ì¢…ë³´í—˜', '08ë°°ìƒì±…ì„ë³´í—˜', '09í•´ìƒë³´í—˜'];
                const categoryTotals = {
                    '06ì¬ì‚°ë³´í—˜': 169,
                    '07íŠ¹ì¢…ë³´í—˜': 182,
                    '08ë°°ìƒì±…ì„ë³´í—˜': 268,
                    '09í•´ìƒë³´í—˜': 170
                };
                
                // ê° ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ í‘œì‹œ
                categories.forEach(category => {
                    const categoryStats = stats.categories && stats.categories[category] 
                        ? stats.categories[category] 
                        : { solved: 0, correct: 0, total: categoryTotals[category] };
                    
                    const progress = categoryStats.total > 0 
                        ? Math.round((categoryStats.solved / categoryStats.total) * 100) 
                        : 0;
                    const accuracy = categoryStats.solved > 0 
                        ? Math.round((categoryStats.correct / categoryStats.solved) * 100) 
                        : 0;
                    
                    // ì¹´ë“œ ì—…ë°ì´íŠ¸
                    const progressElement = document.getElementById(`progress-${category}`);
                    const accuracyElement = document.getElementById(`accuracy-${category}`);
                    
                    if (progressElement) progressElement.textContent = `${progress}%`;
                    if (accuracyElement) accuracyElement.textContent = `${accuracy}%`;
                    
                    console.log(`ğŸ“Š ${category}: ì§„í–‰ë¥  ${progress}%, ì •ë‹µë¥  ${accuracy}%`);
                });
                
                // ìƒì„¸ í†µê³„ í‘œì‹œ
                displayCategoryStats(stats.categories || {});
                
            } catch (error) {
                console.error('âŒ ì¹´í…Œê³ ë¦¬ í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ì¹´í…Œê³ ë¦¬ë³„ ìƒì„¸ í†µê³„ í‘œì‹œ
        function displayCategoryStats(categories) {
            const statsContainer = document.getElementById('category-stats');
            
            // 4ê°œ ì¹´í…Œê³ ë¦¬ë§Œ í•„í„°ë§
            const validCategories = ['06ì¬ì‚°ë³´í—˜', '07íŠ¹ì¢…ë³´í—˜', '08ë°°ìƒì±…ì„ë³´í—˜', '09í•´ìƒë³´í—˜'];
            const categoryNames = {
                '06ì¬ì‚°ë³´í—˜': 'ì¬ì‚°ë³´í—˜',
                '07íŠ¹ì¢…ë³´í—˜': 'íŠ¹ì¢…ë³´í—˜',
                '08ë°°ìƒì±…ì„ë³´í—˜': 'ë°°ìƒì±…ì„ë³´í—˜',
                '09í•´ìƒë³´í—˜': 'í•´ìƒë³´í—˜'
            };
            
            const filteredCategories = {};
            
            for (const category of validCategories) {
                if (categories[category]) {
                    filteredCategories[category] = categories[category];
                }
            }
            
            if (Object.keys(filteredCategories).length === 0) {
                statsContainer.innerHTML = '<p class="text-gray-500 col-span-full text-center">ì•„ì§ ì¹´í…Œê³ ë¦¬ë³„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            let html = '';
            for (const [category, data] of Object.entries(filteredCategories)) {
                const progress = data.total > 0 ? Math.round((data.solved / data.total) * 100) : 0;
                const accuracy = data.solved > 0 ? Math.round((data.correct / data.solved) * 100) : 0;
                
                html += `
                    <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                        <h4 class="font-bold text-gray-800 mb-4 text-center text-lg">${categoryNames[category]}</h4>
                        <div class="space-y-3 text-sm">
                            <div class="flex justify-between items-center p-2 bg-blue-50 rounded">
                                <span class="font-medium">ì§„ë„:</span>
                                <span class="font-bold text-blue-600">${progress}% (${data.solved}/${data.total})</span>
                            </div>
                            <div class="flex justify-between items-center p-2 bg-green-50 rounded">
                                <span class="font-medium">ì •ë‹µë¥ :</span>
                                <span class="font-bold text-green-600">${accuracy}%</span>
                            </div>
                            <div class="flex justify-between items-center p-2 bg-purple-50 rounded">
                                <span class="font-medium">ì •ë‹µ:</span>
                                <span class="font-bold text-purple-600">${data.correct}ë¬¸ì œ</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            statsContainer.innerHTML = html;
        }

        // ì¹´í…Œê³ ë¦¬ë³„ í•™ìŠµ ì‹œì‘
        function startCategoryLearning(category) {
            try {
                console.log(`=== ${category} ì¹´í…Œê³ ë¦¬ í•™ìŠµ ì‹œì‘ ===`);
                
                // ì¹´í…Œê³ ë¦¬ í•™ìŠµ ì‹œì‘ ì´ë²¤íŠ¸ ë°œìƒ
                triggerCategoryLearningStartEvent(category);
                
                // í˜„ì¬ ì¹´í…Œê³ ë¦¬ ì •ë³´ ì €ì¥
                localStorage.setItem('aicu_current_category', category);
                
                // ì¹´í…Œê³ ë¦¬ë³„ ì§„í–‰ìƒí™© ì´ˆê¸°í™” (ì—†ëŠ” ê²½ìš°)
                const progressData = localStorage.getItem('aicu_category_progress') || '{}';
                const progress = JSON.parse(progressData);
                
                if (!progress[category]) {
                    progress[category] = {
                        currentQuestionIndex: 0,
                        lastUpdated: new Date().toISOString()
                    };
                    localStorage.setItem('aicu_category_progress', JSON.stringify(progress));
                }
                
                // ê¸°ë³¸í•™ìŠµ í˜ì´ì§€ë¡œ ì´ë™ (ì¹´í…Œê³ ë¦¬ ëª¨ë“œ)
                window.location.href = `/basic-learning?category=${category}`;
                
            } catch (error) {
                console.error(`âŒ ${category} ì¹´í…Œê³ ë¦¬ í•™ìŠµ ì‹œì‘ ì‹¤íŒ¨:`, error);
                alert('í•™ìŠµì„ ì‹œì‘í•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì¹´í…Œê³ ë¦¬ í•™ìŠµ ì‹œì‘ ì´ë²¤íŠ¸ ë°œìƒ
        function triggerCategoryLearningStartEvent(category) {
            console.log('=== ì¹´í…Œê³ ë¦¬ í•™ìŠµ ì‹œì‘ ì´ë²¤íŠ¸ ë°œìƒ ===');
            
            const categoryLearningData = {
                category: category,
                learningType: 'large_category',
                timestamp: new Date().toISOString(),
                pageUrl: window.location.href
            };
            
            // ì¹´í…Œê³ ë¦¬ í•™ìŠµ ì‹œì‘ ì´ë²¤íŠ¸ ë°œìƒ
            const event = new CustomEvent('categoryLearningStarted', {
                detail: categoryLearningData
            });
            
            document.dispatchEvent(event);
            console.log('âœ… ì¹´í…Œê³ ë¦¬ í•™ìŠµ ì‹œì‘ ì´ë²¤íŠ¸ ë°œìƒ ì™„ë£Œ:', categoryLearningData);
        }

        // ì¹´í…Œê³ ë¦¬ ì§„ë„ ì´ˆê¸°í™”
        function resetCategoryProgress() {
            try {
                if (confirm('ëª¨ë“  ì¹´í…Œê³ ë¦¬ì˜ ì§„ë„ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    console.log('=== ì¹´í…Œê³ ë¦¬ ì§„ë„ ì´ˆê¸°í™” ===');
                    
                    // ì¹´í…Œê³ ë¦¬ë³„ ì§„í–‰ìƒí™© ì´ˆê¸°í™”
                    localStorage.removeItem('aicu_category_progress');
                    
                    // í†µê³„ ë°ì´í„°ì—ì„œ ì¹´í…Œê³ ë¦¬ë³„ ë°ì´í„° ì´ˆê¸°í™”
                    const statsData = localStorage.getItem('aicu_statistics') || '{}';
                    const stats = JSON.parse(statsData);
                    
                    if (stats.categories) {
                        const categories = ['06ì¬ì‚°ë³´í—˜', '07íŠ¹ì¢…ë³´í—˜', '08ë°°ìƒì±…ì„ë³´í—˜', '09í•´ìƒë³´í—˜'];
                        categories.forEach(category => {
                            if (stats.categories[category]) {
                                stats.categories[category].solved = 0;
                                stats.categories[category].correct = 0;
                                stats.categories[category].accuracy = 0;
                                stats.categories[category].current_question_index = 0;
                                stats.categories[category].daily_progress = {};
                            }
                        });
                        
                        localStorage.setItem('aicu_statistics', JSON.stringify(stats));
                    }
                    
                    alert('ì¹´í…Œê³ ë¦¬ ì§„ë„ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    location.reload();
                }
            } catch (error) {
                console.error('âŒ ì¹´í…Œê³ ë¦¬ ì§„ë„ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                alert('ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
    </script>
</body>
</html>
