<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACIU S4 - ëŒ€ë¬¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/static/css/dday_counter.css">
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- í—¤ë” ë° ì‚¬ìš©ì ì •ë³´ -->
        <div class="flex justify-between items-center mb-8">
            <!-- ì¢Œì¸¡: ì‚¬ìš©ì ì •ë³´ -->
            <div id="user-info" class="bg-white rounded-lg shadow-lg p-4">
                <div id="user-details" class="text-sm">
                    <!-- ì‚¬ìš©ì ì •ë³´ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
            
            <!-- ì¤‘ì•™: ì œëª© -->
            <div class="text-center">
                        <h1 class="text-4xl font-bold text-gray-800 mb-2">ğŸ“ AICU Season 4</h1>
        <p class="text-gray-600">ë³´í—˜ì¤‘ê°œì‚¬ ì‹œí—˜ ì¤€ë¹„ í”Œë«í¼</p>
        
        <!-- D-day ì¹´ìš´í„° ì˜ì—­ -->
        <div class="dday-container text-center mb-6">
            <h3 class="text-lg font-semibold mb-2">ğŸ“… ì‹œí—˜ê¹Œì§€ ë‚¨ì€ ì‹œê°„</h3>
            <div id="dday-counter" class="dday-display"></div>
        </div>
        
        <!-- ì‚¬ìš©ì ì •ë³´ í‘œì‹œ ì˜ì—­ -->  
        <div id="user-exam-info" class="user-info-container">
            <!-- D-day ì¹´ìš´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë¨ -->
        </div>
            </div>
            
            <!-- ìš°ì¸¡: ë¹ˆ ê³µê°„ (ê· í˜•ì„ ìœ„í•´) -->
            <div class="w-48"></div>
        </div>

        <!-- ì£¼ìš” í•™ìŠµ í˜„í™© ì¹´ë“œë“¤ -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <!-- í•™ìŠµ ì§„ë„ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">í•™ìŠµ ì§„ë„</p>
                        <p class="text-2xl font-bold text-blue-600" id="progress-rate">0.0% (0/789)</p>
                        <p class="text-sm text-gray-500">ì •ë‹µë¥ : <span id="accuracy-rate">0%</span></p>
                    </div>
                    <div class="text-3xl">ğŸ“š</div>
                </div>
            </div>

            <!-- ì´ í•™ìŠµ í˜„í™© -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">ì´ í•™ìŠµ í˜„í™©</p>
                        <p class="text-2xl font-bold text-green-600" id="total-attempts">ì‹œë„: 0</p>
                        <p class="text-sm text-gray-500">ì •ë‹µ: <span id="total-correct">0</span></p>
                    </div>
                    <div class="text-3xl">ğŸ“Š</div>
                </div>
            </div>

            <!-- ì˜¤ëŠ˜ í•™ìŠµ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-600">ì˜¤ëŠ˜ í•™ìŠµ</p>
                        <p class="text-2xl font-bold text-purple-600" id="today-progress">ë¡œë”© ì¤‘...</p>
                        <p class="text-sm text-gray-500">ì •ë‹µë¥ : <span id="today-accuracy">ë¡œë”© ì¤‘...</span></p>
                    </div>
                    <div class="text-3xl">ğŸ¯</div>
                </div>
            </div>
        </div>

        <!-- ì£¼ìš” ê¸°ëŠ¥ ì„¹ì…˜ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- ê¸°ë³¸í•™ìŠµ -->
            <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                <div class="text-center">
                    <div class="text-4xl mb-4">ğŸ“š</div>
                    <h3 class="text-xl font-bold text-blue-800 mb-2">ê¸°ë³¸í•™ìŠµ</h3>
                    <p class="text-gray-600 mb-4">ì „ì²´ ë¬¸ì œ í•™ìŠµ</p>
                    <a href="/basic-learning" 
                       class="inline-block bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                        í•™ìŠµ ì‹œì‘
                    </a>
                </div>
            </div>

            <!-- ëŒ€ë¶„ë¥˜í•™ìŠµ -->
            <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                <div class="text-center">
                    <div class="text-4xl mb-4">ğŸ¯</div>
                    <h3 class="text-xl font-bold text-green-800 mb-2">ëŒ€ë¶„ë¥˜í•™ìŠµ</h3>
                    <p class="text-gray-600 mb-4">ì¹´í…Œê³ ë¦¬ë³„ í•™ìŠµ</p>
                    <a href="/large-category-learning" 
                       class="inline-block bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                        í•™ìŠµ ì‹œì‘
                    </a>
                </div>
            </div>

            <!-- ê³ ê¸‰ í†µê³„ -->
            <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                <div class="text-center">
                    <div class="text-4xl mb-4">ğŸ“Š</div>
                    <h3 class="text-xl font-bold text-purple-800 mb-2">ê³ ê¸‰ í†µê³„</h3>
                    <p class="text-gray-600 mb-4">ìƒì„¸ ë¶„ì„ ë° íŒ¨í„´</p>
                    <a href="/statistics" 
                       class="inline-block bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                        í†µê³„ ë³´ê¸°
                    </a>
                </div>
            </div>



            <!-- ì„¤ì • -->
            <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                <div class="text-center">
                    <div class="text-4xl mb-4">âš™ï¸</div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">ì„¤ì •</h3>
                    <p class="text-gray-600 mb-4">ì‚¬ìš©ì ì •ë³´ ê´€ë¦¬</p>
                    <a href="/settings" 
                       class="inline-block bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                        ì„¤ì •
                    </a>
                </div>
            </div>
        </div>

        <!-- ê°œë°œì ë„êµ¬ ì„¹ì…˜ -->
        <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ”§ ê°œë°œì ë„êµ¬</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <button onclick="testStatisticsSystem()" 
                        class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                    ğŸš€ í†µê³„ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
                </button>
                <button onclick="debugSession()" 
                        class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                    ğŸ” ì„¸ì…˜ ë””ë²„ê·¸
                </button>
                <button onclick="testAdvancedStatistics()" 
                        class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-colors">
                    ğŸ“Š ê³ ë„í™”ëœ í†µê³„ í…ŒìŠ¤íŠ¸
                </button>
            </div>
        </div>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ìš©ì ì •ë³´ í‘œì‹œ ë° í†µê³„ ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== ëŒ€ë¬¸ í˜ì´ì§€ ë¡œë“œ ===');
            loadUserInfo();
            loadStatistics();
        });

        // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ë° í‘œì‹œ
        function loadUserInfo() {
            try {
                const userData = localStorage.getItem('aicu_user_data');
                
                if (userData) {
                    const user = JSON.parse(userData);
                    displayUserInfo(user);
                    console.log('âœ… ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì™„ë£Œ:', user);
                } else {
                    console.log('âŒ ì‚¬ìš©ì ì •ë³´ ì—†ìŒ');
                    // ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìœ¼ë©´ ë“±ë¡ í˜ì´ì§€ë¡œ ì´ë™
                    window.location.href = '/register';
                }
                
            } catch (error) {
                console.error('âŒ ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                // ì—ëŸ¬ ë°œìƒ ì‹œ ë“±ë¡ í˜ì´ì§€ë¡œ ì´ë™
                window.location.href = '/register';
            }
        }

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        function displayUserInfo(user) {
            const userDetailsElement = document.getElementById('user-details');
            
            // D-Day ê³„ì‚°
            const examDate = new Date(user.exam_date);
            const today = new Date();
            const timeDiff = examDate.getTime() - today.getTime();
            const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
            const dDayText = daysDiff > 0 ? `D-${daysDiff}` : `D+${Math.abs(daysDiff)}`;
            
            userDetailsElement.innerHTML = `
                <div class="font-medium text-gray-800">ğŸ‘¤ ${user.name}</div>
                <div class="text-gray-600">ğŸ“… ${user.exam_date} (${dDayText})</div>
            `;
        }

        // í†µê³„ ë°ì´í„° ë¡œë“œ
        function loadStatistics() {
            try {
                console.log('=== ëŒ€ë¬¸ í˜ì´ì§€ í†µê³„ ë¡œë“œ ì‹œì‘ ===');
                
                // LocalStorageì—ì„œ í†µê³„ ë°ì´í„° ë¡œë“œ
                const statsData = localStorage.getItem('aicu_statistics') || '{}';
                const stats = JSON.parse(statsData);
                
                // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
                const userData = localStorage.getItem('aicu_user_data') || '{}';
                const user = JSON.parse(userData);
                
                console.log('ğŸ“Š ë¡œë“œëœ í†µê³„:', stats);
                console.log('ğŸ‘¤ ì‚¬ìš©ì ì •ë³´:', user);
                
                // ë“±ë¡ ì‹œì  ê¸°ë°˜ í†µê³„ í‘œì‹œ
                displayRegistrationBasedStatistics(stats, user);
                
            } catch (error) {
                console.error('âŒ í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
                displayRegistrationBasedStatistics({}, {});
            }
        }

        // ë“±ë¡ ì‹œì  ê¸°ë°˜ í†µê³„ í‘œì‹œ (ìƒˆë¡œìš´ ì‹œìŠ¤í…œê³¼ ì¼ì¹˜í•˜ë„ë¡ ì—…ë°ì´íŠ¸)
                            function displayRegistrationBasedStatistics(stats, user) {
                        console.log('=== ìƒˆë¡œìš´ í†µê³„ ì‹œìŠ¤í…œ - í™ˆí˜ì´ì§€ í†µê³„ í‘œì‹œ ì‹œì‘ ===');
                        console.log('ğŸ“Š ë°›ì€ í†µê³„ ë°ì´í„°:', stats);
                        
                        // ì´ì–´í’€ê¸° ë°ì´í„°ì™€ ë™ê¸°í™” í™•ì¸
                        const progressData = localStorage.getItem('aicu_quiz_progress');
                        if (progressData) {
                            const progress = JSON.parse(progressData);
                            const currentQuestionIndex = progress.currentQuestionIndex || 0;
                            
                            // í†µê³„ê°€ ì´ì–´í’€ê¸°ë³´ë‹¤ ì ìœ¼ë©´ ì´ì–´í’€ê¸°ì— ë§ì¶¤
                            if (stats.total_questions_attempted < currentQuestionIndex) {
                                console.log(`âš ï¸ í™ˆí˜ì´ì§€: í†µê³„(${stats.total_questions_attempted}) < ì´ì–´í’€ê¸°(${currentQuestionIndex}). ì´ì–´í’€ê¸°ì— ë§ì¶¤`);
                                stats.total_questions_attempted = currentQuestionIndex;
                                stats.accuracy_rate = stats.total_correct_answers > 0 
                                    ? Math.round((stats.total_correct_answers / currentQuestionIndex) * 100)
                                    : 0;
                            }
                        }
            
            // ë“±ë¡ ì‹œì  ì •ë³´ í‘œì‹œ
            const registrationInfo = document.getElementById('registration-info');
            if (registrationInfo && user.registration_date) {
                const registrationDate = new Date(user.registration_date);
                const daysSinceRegistration = Math.floor((new Date() - registrationDate) / (1000 * 60 * 60 * 24));
                registrationInfo.textContent = `ë“±ë¡ì¼: ${user.registration_date} (${daysSinceRegistration}ì¼ì§¸)`;
            }
            
            // 1. í•™ìŠµ ì§„ë„ (ì „ì²´ ë¬¸ì œ ì¤‘ í’€ì´í•œ ë¬¸ì œ ë¹„ìœ¨)
            const progressRateElement = document.getElementById('progress-rate');
            if (progressRateElement) {
                const totalQuestions = 789; // ì „ì²´ ë¬¸ì œ ìˆ˜
                const totalAttempted = stats.total_questions_attempted || 0;
                const progressRate = totalQuestions > 0 
                    ? ((totalAttempted / totalQuestions) * 100).toFixed(1) 
                    : 0;
                progressRateElement.textContent = `${progressRate}% (${totalAttempted}/${totalQuestions})`;
                console.log(`ğŸ“Š í•™ìŠµ ì§„ë„: ${progressRate}% (${totalAttempted}/${totalQuestions})`);
            }
            
            // 2. ì´ í•™ìŠµ í˜„í™© (ì „ì²´ í’€ì´ ë¬¸ì œ ì¤‘ ì •ë‹µë¥ )
            const totalAttemptsElement = document.getElementById('total-attempts');
            const totalCorrectElement = document.getElementById('total-correct');
            if (totalAttemptsElement && totalCorrectElement) {
                const totalAttempted = stats.total_questions_attempted || 0;
                const totalCorrect = stats.total_correct_answers || 0;
                totalAttemptsElement.textContent = `ì‹œë„: ${totalAttempted}`;
                totalCorrectElement.textContent = totalCorrect;
                console.log(`ğŸ“Š ì´ í•™ìŠµ í˜„í™©: ì‹œë„ ${totalAttempted}, ì •ë‹µ ${totalCorrect}`);
            }
            
            // 3. ì˜¤ëŠ˜ í•™ìŠµ (ì˜¤ëŠ˜ í’€ì´í•œ ì´ ë¬¸ì œìˆ˜ì™€ ì •ë‹µë¥ )
            const todayProgressElement = document.getElementById('today-progress');
            const todayAccuracyElement = document.getElementById('today-accuracy');
            if (todayProgressElement && todayAccuracyElement) {
                const today = new Date().toISOString().split('T')[0];
                const todayStats = stats.daily_progress?.[today] || { attempted: 0, correct: 0, accuracy: 0 };
                const todayAttempted = todayStats.attempted || 0;
                const todayAccuracy = todayStats.accuracy || 0;
                todayProgressElement.textContent = `${todayAttempted}ë¬¸ì œ`;
                todayAccuracyElement.textContent = `${todayAccuracy}%`;
                console.log(`ğŸ“Š ì˜¤ëŠ˜ í•™ìŠµ: ${todayAttempted}ë¬¸ì œ, ì •ë‹µë¥  ${todayAccuracy}%`);
            }
            
            // 4. ì „ì²´ ì •ë‹µë¥  í‘œì‹œ (í•™ìŠµ ì§„ë„ ì¹´ë“œì˜ ì •ë‹µë¥ )
            const accuracyRateElement = document.getElementById('accuracy-rate');
            if (accuracyRateElement) {
                const accuracyRate = stats.accuracy_rate || 0;
                accuracyRateElement.textContent = `${accuracyRate}%`;
                console.log(`ğŸ“Š ì „ì²´ ì •ë‹µë¥ : ${accuracyRate}%`);
            }
            
            console.log('âœ… ìƒˆë¡œìš´ í†µê³„ ì‹œìŠ¤í…œ - í™ˆí˜ì´ì§€ í†µê³„ í‘œì‹œ ì™„ë£Œ');
            console.log('ğŸ“Š ìµœì¢… í‘œì‹œëœ í†µê³„:', {
                total_questions_attempted: stats.total_questions_attempted || 0,
                total_correct_answers: stats.total_correct_answers || 0,
                accuracy_rate: stats.accuracy_rate || 0,
                today_stats: stats.daily_progress?.[new Date().toISOString().split('T')[0]] || { attempted: 0, correct: 0, accuracy: 0 }
            });
        }

        // ê°œë°œì ë„êµ¬ í•¨ìˆ˜ë“¤
        function testStatisticsSystem() {
            console.log('=== í†µê³„ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            const userData = localStorage.getItem('aicu_user_data');
            const statsData = localStorage.getItem('aicu_statistics');
            
            console.log('ì‚¬ìš©ì ë°ì´í„°:', userData ? JSON.parse(userData) : 'ì—†ìŒ');
            console.log('í†µê³„ ë°ì´í„°:', statsData ? JSON.parse(statsData) : 'ì—†ìŒ');
            
            alert('í†µê³„ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ê°€ ì½˜ì†”ì— ì¶œë ¥ë˜ì—ˆìŠµë‹ˆë‹¤. (F12ë¡œ í™•ì¸)');
        }

        function debugSession() {
            console.log('=== ì„¸ì…˜ ë””ë²„ê·¸ ì‹œì‘ ===');
            console.log('LocalStorage ì „ì²´ ë‚´ìš©:');
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                console.log(`${key}:`, value);
            }
            
            alert('ì„¸ì…˜ ë””ë²„ê·¸ ì •ë³´ê°€ ì½˜ì†”ì— ì¶œë ¥ë˜ì—ˆìŠµë‹ˆë‹¤. (F12ë¡œ í™•ì¸)');
        }

        function testAdvancedStatistics() {
            console.log('=== ê³ ë„í™”ëœ í†µê³„ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');
            
            // í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
            const testStats = {
                totalQuestions: 789,
                solvedQuestions: 150,
                correctAnswers: 120,
                totalAttempts: 200,
                todayAttempts: 25,
                todayCorrect: 20,
                categories: {
                    'ë³´í—˜ë²•': { solved: 50, correct: 40 },
                    'ë³´í—˜ìƒí’ˆ': { solved: 30, correct: 25 },
                    'ë³´í—˜ì˜ì—…': { solved: 40, correct: 35 },
                    'ë³´í—˜ê³„ë¦¬': { solved: 30, correct: 20 }
                },
                lastUpdated: new Date().toISOString()
            };
            
            // LocalStorageì— í…ŒìŠ¤íŠ¸ ë°ì´í„° ì €ì¥
            localStorage.setItem('aicu_statistics', JSON.stringify(testStats));
            
            // í™”ë©´ ìƒˆë¡œê³ ì¹¨
            location.reload();
            
            alert('ê³ ë„í™”ëœ í†µê³„ í…ŒìŠ¤íŠ¸ ë°ì´í„°ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }


    </script>
    
    <!-- Week1 ê³ ê¸‰í†µê³„ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="/static/js/performance_monitor.js"></script>
    <script src="/static/js/rollback_manager.js"></script>
    <script src="/static/js/guest_mode_defaults.js"></script>
    <script src="/static/js/dday_counter.js"></script>
</body>
</html>
