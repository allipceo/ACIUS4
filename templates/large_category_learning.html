<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACIU S4 - ëŒ€ë¶„ë¥˜ í•™ìŠµ</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- í—¤ë” -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸ¯ ëŒ€ë¶„ë¥˜ í•™ìŠµ</h1>
            <p class="text-gray-600">ì¹´í…Œê³ ë¦¬ë³„ í•™ìŠµì„ í†µí•´ ì²´ê³„ì ìœ¼ë¡œ ì¤€ë¹„í•˜ì„¸ìš”</p>
        </div>

        <!-- ì‚¬ìš©ì ì •ë³´ -->
        <div id="user-info" class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ‘¤ í˜„ì¬ ì‚¬ìš©ì</h2>
            <div id="user-details" class="space-y-2">
                <!-- ì‚¬ìš©ì ì •ë³´ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤ -->
                    </div>
                </div>
                
        <!-- ì¹´í…Œê³ ë¦¬ ì„ íƒ -->
        <div class="max-w-4xl mx-auto mb-8">
            <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“š ì¹´í…Œê³ ë¦¬ ì„ íƒ</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- ë³´í—˜ë²• -->
                <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                    <div class="text-center">
                        <div class="text-4xl mb-4">âš–ï¸</div>
                        <h4 class="text-lg font-bold text-blue-800 mb-2">ë³´í—˜ë²•</h4>
                        <p class="text-gray-600 mb-4">ë³´í—˜ ê´€ë ¨ ë²•ê·œ ë° ì œë„</p>
                        <div class="text-sm text-gray-500 mb-4">
                            <div>ì´ ë¬¸ì œ: <span class="font-medium">200ë¬¸ì œ</span></div>
                            <div>ì§„ë„: <span id="progress-ë³´í—˜ë²•">0%</span></div>
                            <div>ì •ë‹µë¥ : <span id="accuracy-ë³´í—˜ë²•">0%</span></div>
                        </div>
                        <button onclick="startCategoryLearning('ë³´í—˜ë²•')" 
                                class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                            í•™ìŠµ ì‹œì‘
                        </button>
                    </div>
                </div>
                
                <!-- ë³´í—˜ìƒí’ˆ -->
                <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                    <div class="text-center">
                        <div class="text-4xl mb-4">ğŸ“‹</div>
                        <h4 class="text-lg font-bold text-green-800 mb-2">ë³´í—˜ìƒí’ˆ</h4>
                        <p class="text-gray-600 mb-4">ë‹¤ì–‘í•œ ë³´í—˜ìƒí’ˆì˜ íŠ¹ì§•</p>
                        <div class="text-sm text-gray-500 mb-4">
                            <div>ì´ ë¬¸ì œ: <span class="font-medium">200ë¬¸ì œ</span></div>
                            <div>ì§„ë„: <span id="progress-ë³´í—˜ìƒí’ˆ">0%</span></div>
                            <div>ì •ë‹µë¥ : <span id="accuracy-ë³´í—˜ìƒí’ˆ">0%</span></div>
                        </div>
                        <button onclick="startCategoryLearning('ë³´í—˜ìƒí’ˆ')" 
                                class="w-full bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                            í•™ìŠµ ì‹œì‘
                        </button>
                    </div>
                </div>
                
                <!-- ë³´í—˜ì˜ì—… -->
                <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                    <div class="text-center">
                        <div class="text-4xl mb-4">ğŸ’¼</div>
                        <h4 class="text-lg font-bold text-purple-800 mb-2">ë³´í—˜ì˜ì—…</h4>
                        <p class="text-gray-600 mb-4">ë³´í—˜ ì˜ì—… ë° ê³ ê° ê´€ë¦¬</p>
                        <div class="text-sm text-gray-500 mb-4">
                            <div>ì´ ë¬¸ì œ: <span class="font-medium">200ë¬¸ì œ</span></div>
                            <div>ì§„ë„: <span id="progress-ë³´í—˜ì˜ì—…">0%</span></div>
                            <div>ì •ë‹µë¥ : <span id="accuracy-ë³´í—˜ì˜ì—…">0%</span></div>
                        </div>
                        <button onclick="startCategoryLearning('ë³´í—˜ì˜ì—…')" 
                                class="w-full bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-colors">
                            í•™ìŠµ ì‹œì‘
                        </button>
                    </div>
                </div>
                
                <!-- ë³´í—˜ê³„ë¦¬ -->
                <div class="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
                    <div class="text-center">
                        <div class="text-4xl mb-4">ğŸ§®</div>
                        <h4 class="text-lg font-bold text-orange-800 mb-2">ë³´í—˜ê³„ë¦¬</h4>
                        <p class="text-gray-600 mb-4">ë³´í—˜ë£Œ ê³„ì‚° ë° ìœ„í—˜ ê´€ë¦¬</p>
                        <div class="text-sm text-gray-500 mb-4">
                            <div>ì´ ë¬¸ì œ: <span class="font-medium">189ë¬¸ì œ</span></div>
                            <div>ì§„ë„: <span id="progress-ë³´í—˜ê³„ë¦¬">0%</span></div>
                            <div>ì •ë‹µë¥ : <span id="accuracy-ë³´í—˜ê³„ë¦¬">0%</span></div>
                        </div>
                        <button onclick="startCategoryLearning('ë³´í—˜ê³„ë¦¬')" 
                                class="w-full bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg transition-colors">
                            í•™ìŠµ ì‹œì‘
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <!-- í•™ìŠµ í†µê³„ -->
        <div class="max-w-4xl mx-auto mb-8">
            <h3 class="text-xl font-bold text-gray-800 mb-4">ğŸ“Š ì¹´í…Œê³ ë¦¬ë³„ í•™ìŠµ í†µê³„</h3>
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="category-stats">
                    <!-- ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
        <div class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸš€ ì•¡ì…˜</h3>
            <div class="space-y-3">
                <button onclick="resetCategoryProgress()" 
                        class="w-full bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg transition-colors">
                    ğŸ“Š ì¹´í…Œê³ ë¦¬ ì§„ë„ ì´ˆê¸°í™”
                </button>
                <a href="/home" 
                   class="block w-full bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors text-center">
                    ğŸ  ëŒ€ë¬¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </a>
            </div>
        </div>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ìš©ì ì •ë³´ ë° í†µê³„ í‘œì‹œ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== ëŒ€ë¶„ë¥˜ í•™ìŠµ í˜ì´ì§€ ë¡œë“œ ===');
            loadUserInfo();
            loadCategoryStatistics();
        });

        // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ë° í‘œì‹œ
        function loadUserInfo() {
            try {
                const userData = localStorage.getItem('aicu_user_data');
                
                if (userData) {
                    const user = JSON.parse(userData);
                    displayUserInfo(user);
                } else {
                    console.log('âŒ ì‚¬ìš©ì ì •ë³´ ì—†ìŒ');
                    alert('ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”.');
                    window.location.href = '/register';
                }
                
            } catch (error) {
                console.error('âŒ ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                window.location.href = '/register';
            }
        }

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        function displayUserInfo(user) {
            const userDetailsElement = document.getElementById('user-details');
            
            // D-Day ê³„ì‚°
            const examDate = new Date(user.exam_date);
            const today = new Date();
            const timeDiff = examDate.getTime() - today.getTime();
            const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
            const dDayText = daysDiff > 0 ? `D-${daysDiff}` : `D+${Math.abs(daysDiff)}`;
            
            userDetailsElement.innerHTML = `
                <div class="flex justify-between">
                    <span class="font-medium">ì´ë¦„:</span>
                    <span>${user.name}</span>
                </div>
                <div class="flex justify-between">
                    <span class="font-medium">ìœ í˜•:</span>
                    <span class="${user.user_type === 'guest' ? 'text-blue-600' : 'text-green-600'}">
                        ${user.user_type === 'guest' ? 'ê²ŒìŠ¤íŠ¸' : 'ì‹¤ì œ ì‚¬ìš©ì'}
                    </span>
                </div>
                <div class="flex justify-between">
                    <span class="font-medium">D-Day:</span>
                    <span class="font-bold ${daysDiff <= 30 ? 'text-red-600' : 'text-blue-600'}">${dDayText}</span>
                </div>
            `;
        }

        // ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ ë¡œë“œ
        function loadCategoryStatistics() {
            try {
                console.log('=== ëŒ€ë¶„ë¥˜ í•™ìŠµ í†µê³„ ë¡œë“œ ì‹œì‘ ===');
                const statsData = localStorage.getItem('aicu_statistics') || '{}';
                const stats = JSON.parse(statsData);
                
                // 4ê°œ ì¹´í…Œê³ ë¦¬ë§Œ ì²˜ë¦¬ (JSON íŒŒì¼ ê¸°ì¤€)
                const categories = ['06ì¬ì‚°ë³´í—˜', '07íŠ¹ì¢…ë³´í—˜', '08ë°°ìƒì±…ì„ë³´í—˜', '09í•´ìƒë³´í—˜'];
                const categoryTotals = {
                    '06ì¬ì‚°ë³´í—˜': 169,
                    '07íŠ¹ì¢…ë³´í—˜': 182,
                    '08ë°°ìƒì±…ì„ë³´í—˜': 268,
                    '09í•´ìƒë³´í—˜': 170
                };
                
                // ê° ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ í‘œì‹œ
                categories.forEach(category => {
                    const categoryStats = stats.categories && stats.categories[category] 
                        ? stats.categories[category] 
                        : { solved: 0, correct: 0, total: categoryTotals[category] };
                    
                    const progress = categoryStats.total > 0 
                        ? Math.round((categoryStats.solved / categoryStats.total) * 100) 
                        : 0;
                    const accuracy = categoryStats.solved > 0 
                        ? Math.round((categoryStats.correct / categoryStats.solved) * 100) 
                        : 0;
                    
                    // ì¹´ë“œ ì—…ë°ì´íŠ¸
                    const progressElement = document.getElementById(`progress-${category}`);
                    const accuracyElement = document.getElementById(`accuracy-${category}`);
                    
                    if (progressElement) progressElement.textContent = `${progress}%`;
                    if (accuracyElement) accuracyElement.textContent = `${accuracy}%`;
                    
                    console.log(`ğŸ“Š ${category}: ì§„í–‰ë¥  ${progress}%, ì •ë‹µë¥  ${accuracy}%`);
                });
                
                // ìƒì„¸ í†µê³„ í‘œì‹œ
                displayCategoryStats(stats.categories || {});
                
            } catch (error) {
                console.error('âŒ ì¹´í…Œê³ ë¦¬ í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ì¹´í…Œê³ ë¦¬ë³„ ìƒì„¸ í†µê³„ í‘œì‹œ
        function displayCategoryStats(categories) {
            const statsContainer = document.getElementById('category-stats');
            
            // 4ê°œ ì¹´í…Œê³ ë¦¬ë§Œ í•„í„°ë§
            const validCategories = ['ë³´í—˜ë²•', 'ë³´í—˜ìƒí’ˆ', 'ë³´í—˜ì˜ì—…', 'ë³´í—˜ê³„ë¦¬'];
            const filteredCategories = {};
            
            for (const category of validCategories) {
                if (categories[category]) {
                    filteredCategories[category] = categories[category];
                }
            }
            
            if (Object.keys(filteredCategories).length === 0) {
                statsContainer.innerHTML = '<p class="text-gray-500 col-span-full text-center">ì•„ì§ ì¹´í…Œê³ ë¦¬ë³„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            let html = '';
            for (const [category, data] of Object.entries(filteredCategories)) {
                const progress = data.total > 0 ? Math.round((data.solved / data.total) * 100) : 0;
                const accuracy = data.solved > 0 ? Math.round((data.correct / data.solved) * 100) : 0;
                
                html += `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-bold text-gray-800 mb-2">${category}</h4>
                        <div class="space-y-1 text-sm">
                            <div class="flex justify-between">
                                <span>ì§„ë„:</span>
                                <span class="font-medium">${progress}% (${data.solved}/${data.total})</span>
                            </div>
                            <div class="flex justify-between">
                                <span>ì •ë‹µë¥ :</span>
                                <span class="font-medium text-blue-600">${accuracy}%</span>
                            </div>
                            <div class="flex justify-between">
                                <span>ì •ë‹µ:</span>
                                <span class="font-medium text-green-600">${data.correct}ë¬¸ì œ</span>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            statsContainer.innerHTML = html;
        }

        // ì¹´í…Œê³ ë¦¬ í•™ìŠµ ì‹œì‘
        function startCategoryLearning(category) {
            console.log(`=== ${category} ì¹´í…Œê³ ë¦¬ í•™ìŠµ ì‹œì‘ ===`);
            
            // í˜„ì¬ ì¹´í…Œê³ ë¦¬ ì •ë³´ë¥¼ LocalStorageì— ì €ì¥
            localStorage.setItem('aicu_current_category', category);
            
            // ê¸°ë³¸ í•™ìŠµ í˜ì´ì§€ë¡œ ì´ë™ (ì¹´í…Œê³ ë¦¬ í•„í„°ë§ ì ìš©)
            window.location.href = '/basic-learning';
        }

        // ì¹´í…Œê³ ë¦¬ ì§„ë„ ì´ˆê¸°í™”
        function resetCategoryProgress() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ì¹´í…Œê³ ë¦¬ì˜ í•™ìŠµ ì§„ë„ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                try {
                    const statsData = localStorage.getItem('aicu_statistics') || '{}';
                    const stats = JSON.parse(statsData);
                    
                    // 4ê°œ ì¹´í…Œê³ ë¦¬ë§Œ ì´ˆê¸°í™”
                    const categories = ['ë³´í—˜ë²•', 'ë³´í—˜ìƒí’ˆ', 'ë³´í—˜ì˜ì—…', 'ë³´í—˜ê³„ë¦¬'];
                    const categoryTotals = {
                        'ë³´í—˜ë²•': 200,
                        'ë³´í—˜ìƒí’ˆ': 200,
                        'ë³´í—˜ì˜ì—…': 200,
                        'ë³´í—˜ê³„ë¦¬': 189
                    };
                    
                    // ì¹´í…Œê³ ë¦¬ë³„ ë°ì´í„° ì´ˆê¸°í™”
                    if (!stats.categories) stats.categories = {};
                    
                    categories.forEach(category => {
                        stats.categories[category] = {
                            solved: 0,
                            correct: 0,
                            total: categoryTotals[category],
                            current_question_index: 0,
                            daily_progress: {}
                        };
                    });
                    
                    // ì¹´í…Œê³ ë¦¬ë³„ ì§„í–‰ìƒí™©ë„ ì´ˆê¸°í™”
                    const categoryProgress = {};
                    categories.forEach(category => {
                        categoryProgress[category] = {
                            currentQuestionIndex: 0,
                            lastUpdated: new Date().toISOString()
                        };
                    });
                    localStorage.setItem('aicu_category_progress', JSON.stringify(categoryProgress));
                    
                    // ì—…ë°ì´íŠ¸ëœ í†µê³„ ì €ì¥
                    localStorage.setItem('aicu_statistics', JSON.stringify(stats));
                    
                    alert('ì¹´í…Œê³ ë¦¬ ì§„ë„ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    console.log('âœ… ì¹´í…Œê³ ë¦¬ ì§„ë„ ì´ˆê¸°í™” ì™„ë£Œ');
                    
                    // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                    location.reload();
                    
                } catch (error) {
                    console.error('âŒ ì¹´í…Œê³ ë¦¬ ì§„ë„ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    alert('ì¹´í…Œê³ ë¦¬ ì§„ë„ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }
    </script>
</body>
</html>
