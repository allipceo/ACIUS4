<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACIU S4 - ëŒ€ë¶„ë¥˜ í•™ìŠµ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- í—¤ë” -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-blue-600 mb-2">ACIU QUIZ</h1>
            <p class="text-gray-600">ë³´í—˜ì¤‘ê°œì‚¬ ìê²©ì¦ í•™ìŠµ ì‹œìŠ¤í…œ - Season 4</p>
            <div id="status" class="text-center text-blue-600 mb-4 font-semibold">ëŒ€ë¶„ë¥˜ í•™ìŠµ ëª¨ë“œ</div>
        </header>

        <!-- ëŒ€ë¶„ë¥˜ í•™ìŠµ í™”ë©´ -->
        <div id="large-category-learning-screen" class="bg-white rounded-lg shadow-md p-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold">ëŒ€ë¶„ë¥˜ í•™ìŠµ</h2>
                
                <!-- ì¡°ëŒ€í‘œë‹˜ ìš”êµ¬ì‚¬í•­: 2ì¤„ êµ¬ì¡° í†µê³„ -->
                <div class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200 min-w-[300px]">
                    <!-- ëˆ„ì í˜„í™© (1ì¤„) -->
                    <div class="mb-2">
                        <span class="text-sm font-medium text-gray-700">ëˆ„ì í˜„í™©:</span>
                        <span class="ml-2 text-sm">
                            ì´ <span id="cumulative-total" class="font-bold text-blue-600">0</span>ë¬¸ì œ | 
                            ì •ë‹µ <span id="cumulative-correct" class="font-bold text-green-600">0</span>ê°œ | 
                            ì •ë‹µë¥  <span id="cumulative-accuracy" class="font-bold text-purple-600">0</span>%
                        </span>
                    </div>
                    <!-- ê¸ˆì¼í˜„í™© (2ì¤„) -->
                    <div>
                        <span class="text-sm font-medium text-gray-700">ê¸ˆì¼í˜„í™©:</span>
                        <span class="ml-2 text-sm">
                            ê¸ˆì¼ <span id="today-total" class="font-bold text-orange-600">0</span>ë¬¸ì œ | 
                            ì •ë‹µ <span id="today-correct" class="font-bold text-green-600">0</span>ê°œ | 
                            ì •ë‹µë¥  <span id="today-accuracy" class="font-bold text-red-600">0</span>%
                        </span>
                    </div>
                </div>
                
                <button onclick="goHome()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">
                    í™ˆìœ¼ë¡œ
                </button>
            </div>
            
            <!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
            <div class="mb-6" id="category-tabs">
                <h3 class="text-lg font-semibold mb-4">ì¹´í…Œê³ ë¦¬ ì„ íƒ</h3>
                <div class="flex gap-3 w-full" id="category-tab-container">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ì¹´í…Œê³ ë¦¬ íƒ­ë“¤ -->
                </div>
            </div>
            
            <!-- ëŒ€ë¶„ë¥˜ í•™ìŠµ ë¬¸ì œ í‘œì‹œ ì˜ì—­ -->
            <div id="large-category-question-area" class="hidden">
                <!-- ì¹´í…Œê³ ë¦¬ë³„ ì§„í–‰ ìƒí™© -->
                <div class="mb-4 p-3 bg-green-50 rounded border border-green-200">
                    <div id="category-progress" class="text-sm font-medium text-green-700">
                        ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.
                    </div>
                </div>
                <h3 class="text-lg font-semibold mb-4">ë¬¸ì œ í’€ì´</h3>
                

                
                <!-- ë¬¸ì œ ì •ë³´ -->
                <div class="mb-4 p-4 bg-gray-50 rounded">
                    <div class="flex justify-between items-center mb-2">
                        <span id="question-type" class="text-sm text-blue-600 font-medium">ì§„ìœ„í˜•</span>
                        <span id="question-code" class="text-sm text-gray-600">Q001</span>
                    </div>
                    <div id="layer-info" class="text-sm text-gray-500 mb-2">ì¬ì‚°ë³´í—˜ > ì¼ë°˜ì¬ì‚°ë³´í—˜</div>
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-sm text-gray-600">ì§„ë„</span>
                        <span id="progress-info" class="text-sm font-medium text-blue-600">1 / 100</span>
                    </div>
                    <div id="question-text" class="text-lg font-medium">ë¬¸ì œ í…ìŠ¤íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
                </div>
                
                <!-- ë‹µì•ˆ ë²„íŠ¼ ì˜ì—­ -->
                <div id="answer-buttons" class="mb-4">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ë‹µì•ˆ ë²„íŠ¼ë“¤ -->
                </div>
                
                <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
                <div id="result-area" class="hidden">
                    <div id="result-message" class="p-3 rounded font-medium"></div>
                </div>
                
                <!-- ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
                <div class="flex justify-between items-center mt-6">
                    <button onclick="largeCategorySystem.prevQuestion()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">
                        â† ì´ì „ ë¬¸ì œ
                    </button>
                    
                    <button id="check-button" onclick="largeCategorySystem.checkAnswer()" disabled class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg font-semibold">
                        ì •ë‹µ í™•ì¸
                    </button>
                    
                    <button onclick="largeCategorySystem.nextQuestion()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">
                        ë‹¤ìŒ ë¬¸ì œ â†’
                    </button>
                </div>
                
                <!-- ìƒì„¸ í†µê³„ -->
                <div class="mt-8 p-4 bg-gray-50 rounded">
                    <h4 class="font-semibold mb-3">ìƒì„¸ í†µê³„</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                        <div>
                            <span class="text-gray-600">ì´ ë¬¸ì œ ìˆ˜:</span>
                            <span id="total-questions" class="ml-2 font-bold">0</span>
                        </div>
                        <div>
                            <span class="text-gray-600">ì •ë‹µ ìˆ˜:</span>
                            <span id="correct-answers" class="ml-2 font-bold text-green-600">0</span>
                        </div>
                        <div>
                            <span class="text-gray-600">ì˜¤ë‹µ ìˆ˜:</span>
                            <span id="wrong-answers" class="ml-2 font-bold text-red-600">0</span>
                        </div>
                        <div>
                            <span class="text-gray-600">ì—°ì† ì •ë‹µ:</span>
                            <span id="current-streak" class="ml-2 font-bold text-orange-600">0</span>
                        </div>
                    </div>
                </div>
                
                <!-- í†µê³„ ê´€ë¦¬ ë²„íŠ¼ -->
                <div class="mt-4 flex justify-center space-x-4">
                    <button onclick="resetLargeCategoryStatistics()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm">
                        í†µê³„ ì´ˆê¸°í™”
                    </button>
                    <button onclick="exportLargeCategoryStatistics()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm">
                        í†µê³„ ë‚´ë³´ë‚´ê¸°
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript ëª¨ë“ˆ ë¡œë“œ -->
    <script src="/static/js/large_category_data_filter.js"></script>
    <script src="/static/js/large_category_main.js"></script>
    <script src="/static/js/large_category_ui.js"></script>
    <script src="/static/js/large_category_stats.js"></script>
    
    <!-- ê³ ë„í™”ëœ í†µê³„ ì‹œìŠ¤í…œ ìŠ¤í¬ë¦½íŠ¸ë“¤ -->
    <script src="/static/js/advanced_progress_manager.js"></script>
    <script src="/static/js/real_time_stats_updater.js"></script>
    <script src="/static/js/advanced_statistics_system.js"></script>
    
    <script>
        // ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™”
        let currentQuestionData = [];
        let currentQuestionIndex = 0;
        let selectedAnswer = null;
        let isAnswerChecked = false;
        let selectedCategory = null;
        let userStatistics = null;
        let currentUser = null;
        let isFlaskMode = true;
        let learningMode = 'large_category';
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== ëŒ€ë¶„ë¥˜ í•™ìŠµ í˜ì´ì§€ ë¡œë“œ ===');
            
            // UI ì´ˆê¸°í™”
            initializeLargeCategoryUI();
            
            // í†µê³„ ì´ˆê¸°í™”
            initializeLargeCategoryStatistics();
            
            // ê³ ë„í™”ëœ í†µê³„ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
            initializeAdvancedStatisticsSystem();
            
            console.log('ëŒ€ë¶„ë¥˜ í•™ìŠµ í˜ì´ì§€ ì´ˆê¸°í™” ì™„ë£Œ');
        });
        
        // ê³ ë„í™”ëœ í†µê³„ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
        async function initializeAdvancedStatisticsSystem() {
            console.log('ğŸ¯ ëŒ€ë¶„ë¥˜ í•™ìŠµ í˜ì´ì§€ ê³ ë„í™”ëœ í†µê³„ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹œì‘...');
            
            // AdvancedStatisticsSystem ì´ˆê¸°í™” ëŒ€ê¸°
            setTimeout(async () => {
                if (typeof window.advancedStatisticsSystem !== 'undefined') {
                    try {
                        // ì‹œìŠ¤í…œ ì´ˆê¸°í™”
                        const initResult = await window.advancedStatisticsSystem.initialize();
                        if (initResult) {
                            console.log('âœ… ëŒ€ë¶„ë¥˜ í•™ìŠµ í˜ì´ì§€ ê³ ë„í™”ëœ í†µê³„ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
                            
                            // ëŒ€ë¶„ë¥˜ í•™ìŠµ í†µê³„ ì—…ë°ì´íŠ¸
                            updateLargeCategoryStats();
                            
                            console.log('âœ… ëŒ€ë¶„ë¥˜ í•™ìŠµ í˜ì´ì§€ í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                        } else {
                            console.error('âŒ ëŒ€ë¶„ë¥˜ í•™ìŠµ í˜ì´ì§€ ê³ ë„í™”ëœ í†µê³„ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨');
                        }
                    } catch (error) {
                        console.error('âŒ ê³ ë„í™”ëœ í†µê³„ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜:', error);
                    }
                } else {
                    console.error('âŒ AdvancedStatisticsSystem ëª¨ë“ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            }, 2000);
        }
        
        // ëŒ€ë¶„ë¥˜ í•™ìŠµ í†µê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateLargeCategoryStats() {
            if (window.advancedProgressManager) {
                // ì „ì²´ ëŒ€ë¶„ë¥˜ í•™ìŠµ í†µê³„ ê³„ì‚°
                let totalAttempted = 0;
                let totalCorrect = 0;
                let todayAttempted = 0;
                let todayCorrect = 0;
                
                // ê° ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ í•©ì‚°
                Object.values(window.advancedProgressManager.progressData.categories).forEach(category => {
                    totalAttempted += category.total_attempted;
                    totalCorrect += category.total_correct;
                    todayAttempted += category.today_attempted;
                    todayCorrect += category.today_correct;
                });
                
                // ëˆ„ì í˜„í™© ì—…ë°ì´íŠ¸
                const cumulativeTotal = document.getElementById('cumulative-total');
                if (cumulativeTotal) {
                    cumulativeTotal.textContent = totalAttempted;
                }
                
                const cumulativeCorrect = document.getElementById('cumulative-correct');
                if (cumulativeCorrect) {
                    cumulativeCorrect.textContent = totalCorrect;
                }
                
                const cumulativeAccuracy = document.getElementById('cumulative-accuracy');
                if (cumulativeAccuracy) {
                    const accuracy = totalAttempted > 0 ? Math.round((totalCorrect / totalAttempted) * 100) : 0;
                    cumulativeAccuracy.textContent = accuracy;
                }
                
                // ê¸ˆì¼í˜„í™© ì—…ë°ì´íŠ¸
                const todayTotal = document.getElementById('today-total');
                if (todayTotal) {
                    todayTotal.textContent = todayAttempted;
                }
                
                const todayCorrect = document.getElementById('today-correct');
                if (todayCorrect) {
                    todayCorrect.textContent = todayCorrect;
                }
                
                const todayAccuracy = document.getElementById('today-accuracy');
                if (todayAccuracy) {
                    const todayAccuracyValue = todayAttempted > 0 ? Math.round((todayCorrect / todayAttempted) * 100) : 0;
                    todayAccuracy.textContent = todayAccuracyValue;
                }
            }
        }
        
        // ì •ë‹µ í™•ì¸ ì‹œ ê³ ë„í™”ëœ í†µê³„ ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸
        function updateLargeCategoryAnswerStats(category, questionNumber, isCorrect) {
            console.log(`âœ… ëŒ€ë¶„ë¥˜ í•™ìŠµ ì •ë‹µ í™•ì¸: ${category} - Q${questionNumber} - ${isCorrect ? 'ì •ë‹µ' : 'ì˜¤ë‹µ'}`);
            
            // AdvancedStatisticsSystemì— ì§„ë„ ì €ì¥
            if (typeof window.advancedStatisticsSystem !== 'undefined' && window.advancedStatisticsSystem.isInitialized) {
                const updateResult = window.advancedStatisticsSystem.updateOnQuestionSolved(category, questionNumber, isCorrect);
                if (updateResult) {
                    console.log('âœ… ëŒ€ë¶„ë¥˜ í•™ìŠµ ê³ ë„í™”ëœ í†µê³„ ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                    
                    // í†µê³„ ë°•ìŠ¤ ì—…ë°ì´íŠ¸
                    updateLargeCategoryStats();
                    
                } else {
                    console.error('âŒ ëŒ€ë¶„ë¥˜ í•™ìŠµ ê³ ë„í™”ëœ í†µê³„ ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨');
                }
            }
        }
        
        // ê¸°ì¡´ ì •ë‹µ í™•ì¸ í•¨ìˆ˜ë¥¼ ìƒˆë¡œìš´ í•¨ìˆ˜ë¡œ êµì²´
        if (typeof largeCategorySystem !== 'undefined' && largeCategorySystem.checkAnswer) {
            const originalCheckAnswer = largeCategorySystem.checkAnswer;
            largeCategorySystem.checkAnswer = function() {
                // í˜„ì¬ ì¹´í…Œê³ ë¦¬ì™€ ë¬¸ì œ ë²ˆí˜¸, ì •ë‹µ ì—¬ë¶€ë¥¼ ê°€ì ¸ì™€ì„œ í†µê³„ ì—…ë°ì´íŠ¸
                if (selectedCategory && currentQuestionData.length > 0) {
                    const currentQuestion = currentQuestionData[currentQuestionIndex];
                    const questionNumber = currentQuestion.question_number || currentQuestionIndex + 1;
                    const isCorrect = selectedAnswer === currentQuestion.correct_answer;
                    
                    updateLargeCategoryAnswerStats(selectedCategory, questionNumber, isCorrect);
                }
                
                // ê¸°ì¡´ ì •ë‹µ í™•ì¸ ë¡œì§ ì‹¤í–‰
                originalCheckAnswer.call(this);
            };
        }
    </script>
</body>
</html>
