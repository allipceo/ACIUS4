<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AICU S4 - ì„¤ì •</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- í—¤ë” -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">âš™ï¸ ì„¤ì •</h1>
            <p class="text-white/80">ì‚¬ìš©ì ì •ë³´ ë° ë°ì´í„° ê´€ë¦¬</p>
        </div>

        <!-- ë©”ì¸ ì„¤ì • ì¹´ë“œ -->
        <div class="max-w-2xl mx-auto">
            <div class="bg-white rounded-xl card-shadow p-8">
                
                <!-- í˜„ì¬ ì‚¬ìš©ì ì •ë³´ í‘œì‹œ -->
                <div class="mb-8 p-4 bg-blue-50 rounded-lg">
                    <h3 class="text-lg font-semibold text-blue-800 mb-2">ğŸ‘¤ í˜„ì¬ ì‚¬ìš©ì</h3>
                    <div id="current-user-info" class="text-blue-700">
                        ë¡œë”© ì¤‘...
                    </div>
                </div>

                <!-- ì‚¬ìš©ì ë“±ë¡ í¼ -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ“ ì‚¬ìš©ì ë“±ë¡</h3>
                    
                    <form id="user-registration-form" class="space-y-4">
                        <div>
                            <label for="user-name" class="block text-sm font-medium text-gray-700 mb-1">
                                ì´ë¦„ *
                            </label>
                            <input type="text" 
                                   id="user-name" 
                                   name="name" 
                                   required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   placeholder="ì˜ˆ: ì¡°ì€ìƒ">
                        </div>
                        
                        <div>
                            <label for="user-phone" class="block text-sm font-medium text-gray-700 mb-1">
                                ì „í™”ë²ˆí˜¸
                            </label>
                            <input type="tel" 
                                   id="user-phone" 
                                   name="phone" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                   placeholder="ì˜ˆ: 010-1234-5678">
                        </div>
                        
                        <div>
                            <label for="exam-date" class="block text-sm font-medium text-gray-700 mb-1">
                                ì‹œí—˜ì¼ì
                            </label>
                            <input type="date" 
                                   id="exam-date" 
                                   name="exam_date" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div class="pt-4">
                            <button type="submit" 
                                    class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                                âœ… ì‚¬ìš©ì ë“±ë¡
                            </button>
                        </div>
                    </form>
                </div>

                <!-- ë°ì´í„° ê´€ë¦¬ ì„¹ì…˜ -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ—„ï¸ ë°ì´í„° ê´€ë¦¬</h3>
                    
                    <div class="space-y-3">
                        <button onclick="clearAllData()" 
                                class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”
                        </button>
                        
                        <button onclick="exportUserData()" 
                                class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            ğŸ“¤ ì‚¬ìš©ì ë°ì´í„° ë‚´ë³´ë‚´ê¸°
                        </button>
                    </div>
                </div>

                <!-- ê°œë°œì ë„êµ¬ ì„¹ì…˜ -->
                <div class="mb-8">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4">ğŸ”§ ê°œë°œì ë„êµ¬</h3>
                    
                    <div class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <p class="text-blue-800 text-sm">
                            <strong>ê°œë°œì ì „ìš©:</strong> ì‹œìŠ¤í…œ ê´€ë¦¬ ë° ë””ë²„ê¹…ì„ ìœ„í•œ ê³ ê¸‰ ë„êµ¬ì…ë‹ˆë‹¤.
                        </p>
                    </div>
                    
                    <div class="space-y-3">
                        <a href="/developer-tools" 
                           class="block w-full bg-orange-600 hover:bg-orange-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors text-center">
                            ğŸ”§ ê°œë°œì ë„êµ¬ ì—´ê¸°
                        </a>
                        
                        <button onclick="openSystemDiagnostics()" 
                                class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            ğŸ” ì‹œìŠ¤í…œ ì§„ë‹¨
                        </button>
                        
                        <button onclick="testDataIntegrity()" 
                                class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            âœ… ë°ì´í„° ë¬´ê²°ì„± ê²€ì‚¬
                        </button>
                        
                        <button onclick="clearSystemCache()" 
                                class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            ğŸ—‘ï¸ ì‹œìŠ¤í…œ ìºì‹œ ì •ë¦¬
                        </button>
                    </div>
                </div>

                <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
                <div class="border-t pt-6">
                    <div class="grid grid-cols-1 gap-3">
                        <button onclick="goToHome()" 
                                class="w-full bg-gray-600 hover:bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                            ğŸ  í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°
                        </button>
                    </div>
                </div>

            </div>
        </div>

        <!-- ìƒíƒœ ë©”ì‹œì§€ -->
        <div id="status-message" class="fixed top-4 right-4 max-w-sm bg-white rounded-lg shadow-lg p-4 transform translate-x-full transition-transform duration-300">
            <div class="flex items-center">
                <div id="status-icon" class="mr-3 text-xl">âœ…</div>
                <div>
                    <div id="status-title" class="font-semibold text-gray-800">ì„±ê³µ</div>
                    <div id="status-text" class="text-sm text-gray-600">ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ í˜„ì¬ ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        document.addEventListener('DOMContentLoaded', function() {
            loadCurrentUserInfo();
        });

        // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ë¡œë“œ
        function loadCurrentUserInfo() {
            try {
                const userData = localStorage.getItem('aicu_user_data');
                const userInfoDiv = document.getElementById('current-user-info');
                
                if (userData) {
                    const user = JSON.parse(userData);
                    userInfoDiv.innerHTML = `
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div><strong>ì´ë¦„:</strong> ${user.name || 'ë¯¸ë“±ë¡'}</div>
                            <div><strong>ì „í™”ë²ˆí˜¸:</strong> ${user.phone || 'ë¯¸ë“±ë¡'}</div>
                            <div><strong>ì‹œí—˜ì¼ì:</strong> ${user.exam_date || 'ë¯¸ë“±ë¡'}</div>
                            <div><strong>ë“±ë¡ì¼:</strong> ${user.registration_date || 'ë¯¸ë“±ë¡'}</div>
                        </div>
                    `;
                } else {
                    userInfoDiv.innerHTML = '<div class="text-red-600">ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            } catch (error) {
                console.error('ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                document.getElementById('current-user-info').innerHTML = '<div class="text-red-600">ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨</div>';
            }
        }

        // ì‚¬ìš©ì ë“±ë¡ í¼ ì²˜ë¦¬
        document.getElementById('user-registration-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const userData = {
                name: formData.get('name'),
                phone: formData.get('phone') || '',
                exam_date: formData.get('exam_date') || '',
                registration_date: new Date().toISOString().split('T')[0],
                exam_subject: 'AICU',
                is_guest: false,
                created_at: new Date().toISOString()
            };

            try {
                // ì‚¬ìš©ì ë°ì´í„° ì €ì¥
                localStorage.setItem('aicu_user_data', JSON.stringify(userData));
                
                // í†µê³„ ë°ì´í„° ì´ˆê¸°í™” (ë“±ë¡ì¼ ê¸°ì¤€)
                initializeStatistics(userData);
                
                showStatusMessage('âœ… ì‚¬ìš©ì ë“±ë¡ ì™„ë£Œ', 'ì‚¬ìš©ì ì •ë³´ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                
                // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ìƒˆë¡œê³ ì¹¨
                setTimeout(() => {
                    loadCurrentUserInfo();
                }, 1000);
                
            } catch (error) {
                console.error('ì‚¬ìš©ì ë“±ë¡ ì‹¤íŒ¨:', error);
                showStatusMessage('âŒ ë“±ë¡ ì‹¤íŒ¨', 'ì‚¬ìš©ì ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        });

        // í†µê³„ ë°ì´í„° ì´ˆê¸°í™”
        function initializeStatistics(userData) {
            const today = new Date().toISOString().split('T')[0];
            
            const statistics = {
                user_id: userData.name,
                registration_date: userData.registration_date,
                last_updated: today,
                total_problems_solved: 0,
                total_correct_answers: 0,
                total_accuracy: 0,
                daily_stats: {
                    [today]: {
                        problems_solved: 0,
                        correct_answers: 0,
                        accuracy: 0
                    }
                },
                category_stats: {},
                learning_log: []
            };
            
            localStorage.setItem('aicu_statistics', JSON.stringify(statistics));
            console.log('âœ… í†µê³„ ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ:', statistics);
        }

                        // ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™” (ë“±ë¡ ì‹œì  í¬í•¨)
                function clearAllData() {
                    if (confirm('âš ï¸ ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë‹¤ìŒì„ í¬í•¨í•©ë‹ˆë‹¤:\nâ€¢ ëª¨ë“  í•™ìŠµ ë°ì´í„°\nâ€¢ ëª¨ë“  í†µê³„ ë°ì´í„°\nâ€¢ ë“±ë¡ ì‹œì  ì •ë³´\nâ€¢ ì‚¬ìš©ì ì •ë³´\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                        try {
                            console.log('=== ì™„ì „í•œ ë°ì´í„° ì´ˆê¸°í™” ì‹œì‘ ===');
                            
                            // ë“±ë¡ ì‹œì  ê´€ë ¨ ë°ì´í„° ëª…ì‹œì  ì‚­ì œ
                            localStorage.removeItem('aicu_registration_completed');
                            localStorage.removeItem('aicu_registration_timestamp');
                            localStorage.removeItem('aicu_user_data');
                            localStorage.removeItem('aicu_statistics');
                            localStorage.removeItem('aicu_real_time_data');
                            localStorage.removeItem('aicu_quiz_results');
                            localStorage.removeItem('aicu_category_statistics');
                            
                            // localStorage ì™„ì „ í´ë¦¬ì–´
                            localStorage.clear();
                            
                            // ê²ŒìŠ¤íŠ¸ ëª¨ë“œ ê¸°ë³¸ê°’ ì¬ì ìš© (ìƒˆë¡œìš´ ë“±ë¡ ì‹œì ìœ¼ë¡œ)
                            setTimeout(() => {
                                applyGuestModeDefaults();
                            }, 100);
                            
                            showStatusMessage('ğŸ—‘ï¸ ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ', 'ëª¨ë“  ë°ì´í„°ì™€ ë“±ë¡ ì‹œì ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                            
                            // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ìƒˆë¡œê³ ì¹¨
                            setTimeout(() => {
                                loadCurrentUserInfo();
                            }, 1000);
                            
                            console.log('âœ… ì™„ì „í•œ ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ (ë“±ë¡ ì‹œì  í¬í•¨)');
                            
                        } catch (error) {
                            console.error('ë°ì´í„° ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                            showStatusMessage('âŒ ì´ˆê¸°í™” ì‹¤íŒ¨', 'ë°ì´í„° ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
                        }
                    }
                }

        // ê²ŒìŠ¤íŠ¸ ëª¨ë“œ ê¸°ë³¸ê°’ ì ìš©
        function applyGuestModeDefaults() {
            try {
                console.log('=== ê²ŒìŠ¤íŠ¸ ëª¨ë“œ ê¸°ë³¸ê°’ ì ìš© ===');
                
                const defaultUserData = {
                    name: 'ê²ŒìŠ¤íŠ¸',
                    registration_date: new Date().toISOString().split('T')[0],
                    exam_subject: 'AICU',
                    exam_date: '2025-09-13',
                    phone: '010-1234-5678',
                    is_guest: true,
                    created_at: new Date().toISOString()
                };
                
                const defaultStatistics = {
                    user_id: 'ê²ŒìŠ¤íŠ¸',
                    registration_date: defaultUserData.registration_date,
                    last_updated: new Date().toISOString().split('T')[0],
                    total_problems_solved: 0,
                    total_correct_answers: 0,
                    total_accuracy: 0,
                    daily_stats: {},
                    category_stats: {},
                    learning_log: []
                };
                
                // ì˜ˆìƒì ìˆ˜ ê³„ì‚°ì— ì‚¬ìš©ë˜ëŠ” ì‹¤ì‹œê°„ ë°ì´í„°ë„ ì´ˆê¸°í™”
                const defaultRealTimeData = {
                    categories: {
                        "06ì¬ì‚°ë³´í—˜": { total: 0, correct: 0, incorrect: 0, accuracy: 0 },
                        "07íŠ¹ì¢…ë³´í—˜": { total: 0, correct: 0, incorrect: 0, accuracy: 0 },
                        "08ë°°ìƒì±…ì„ë³´í—˜": { total: 0, correct: 0, incorrect: 0, accuracy: 0 },
                        "09í•´ìƒë³´í—˜": { total: 0, correct: 0, incorrect: 0, accuracy: 0 }
                    },
                    last_updated: new Date().toISOString()
                };
                
                // í•™ìŠµ ë¡œê·¸ ì´ˆê¸°í™” (ëˆ„ë½ëœ í‚¤)
                const defaultLearningLog = {
                    user_id: 'ê²ŒìŠ¤íŠ¸',
                    registration_date: defaultUserData.registration_date,
                    logs: [],
                    last_updated: new Date().toISOString()
                };
                
                // ê¸°ë³¸ê°’ ì €ì¥
                localStorage.setItem('aicu_user_data', JSON.stringify(defaultUserData));
                localStorage.setItem('aicu_statistics', JSON.stringify(defaultStatistics));
                localStorage.setItem('aicu_real_time_data', JSON.stringify(defaultRealTimeData));
                localStorage.setItem('aicu_learning_log', JSON.stringify(defaultLearningLog));
                
                console.log('âœ… ê²ŒìŠ¤íŠ¸ ëª¨ë“œ ê¸°ë³¸ê°’ ì ìš© ì™„ë£Œ (ì‹¤ì‹œê°„ ë°ì´í„° ë° í•™ìŠµ ë¡œê·¸ í¬í•¨)');
                
            } catch (error) {
                console.error('âŒ ê²ŒìŠ¤íŠ¸ ëª¨ë“œ ê¸°ë³¸ê°’ ì ìš© ì‹¤íŒ¨:', error);
            }
        }

        // ì‚¬ìš©ì ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportUserData() {
            try {
                const userData = localStorage.getItem('aicu_user_data');
                const statistics = localStorage.getItem('aicu_statistics');
                
                if (!userData) {
                    showStatusMessage('âŒ ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨', 'ë‚´ë³´ë‚¼ ì‚¬ìš©ì ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                    return;
                }
                
                const exportData = {
                    user_data: JSON.parse(userData),
                    statistics: statistics ? JSON.parse(statistics) : null,
                    export_date: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `aicu_user_data_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showStatusMessage('ğŸ“¤ ë‚´ë³´ë‚´ê¸° ì™„ë£Œ', 'ì‚¬ìš©ì ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤.', 'success');
                
            } catch (error) {
                console.error('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨:', error);
                showStatusMessage('âŒ ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨', 'ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        }

        // í™ˆìœ¼ë¡œ ì´ë™
        function goToHome() {
            try {
                window.location.replace('/');
            } catch (error) {
                window.location.assign('/');
            }
        }

        // ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
        function showStatusMessage(title, text, type = 'success') {
            const statusMessage = document.getElementById('status-message');
            const statusIcon = document.getElementById('status-icon');
            const statusTitle = document.getElementById('status-title');
            const statusText = document.getElementById('status-text');
            
            // ì•„ì´ì½˜ ì„¤ì •
            if (type === 'success') {
                statusIcon.textContent = 'âœ…';
                statusMessage.className = 'fixed top-4 right-4 max-w-sm bg-green-50 border border-green-200 rounded-lg shadow-lg p-4 transform translate-x-full transition-transform duration-300';
            } else if (type === 'error') {
                statusIcon.textContent = 'âŒ';
                statusMessage.className = 'fixed top-4 right-4 max-w-sm bg-red-50 border border-red-200 rounded-lg shadow-lg p-4 transform translate-x-full transition-transform duration-300';
            } else {
                statusIcon.textContent = 'â„¹ï¸';
                statusMessage.className = 'fixed top-4 right-4 max-w-sm bg-blue-50 border border-blue-200 rounded-lg shadow-lg p-4 transform translate-x-full transition-transform duration-300';
            }
            
            statusTitle.textContent = title;
            statusText.textContent = text;
            
            // ë©”ì‹œì§€ í‘œì‹œ
            statusMessage.classList.remove('translate-x-full');
            
            // 3ì´ˆ í›„ ìë™ ìˆ¨ê¹€
            setTimeout(() => {
                statusMessage.classList.add('translate-x-full');
            }, 3000);
        }

        // === ê°œë°œì ë„êµ¬ ê´€ë ¨ í•¨ìˆ˜ë“¤ ===

        // ì‹œìŠ¤í…œ ì§„ë‹¨ ì‹¤í–‰
        function openSystemDiagnostics() {
            try {
                console.log('=== ì‹œìŠ¤í…œ ì§„ë‹¨ ì‹œì‘ ===');
                
                const diagnostics = {
                    timestamp: new Date().toISOString(),
                    browser: navigator.userAgent,
                    localStorage: {
                        available: typeof(Storage) !== "undefined",
                        used: 0,
                        total: 0
                    },
                    userData: null,
                    statistics: null,
                    systemHealth: 'unknown'
                };

                // LocalStorage ì‚¬ìš©ëŸ‰ ê³„ì‚°
                let usedSpace = 0;
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key) {
                        usedSpace += localStorage.getItem(key).length;
                    }
                }
                diagnostics.localStorage.used = usedSpace;
                diagnostics.localStorage.total = 5 * 1024 * 1024; // 5MB (ì¼ë°˜ì ì¸ ì œí•œ)

                // ì‚¬ìš©ì ë°ì´í„° í™•ì¸
                const userData = localStorage.getItem('aicu_user_data');
                if (userData) {
                    diagnostics.userData = JSON.parse(userData);
                }

                // í†µê³„ ë°ì´í„° í™•ì¸
                const statisticsData = localStorage.getItem('aicu_statistics');
                if (statisticsData) {
                    diagnostics.statistics = JSON.parse(statisticsData);
                }

                // ì‹œìŠ¤í…œ ê±´ê°•ë„ í‰ê°€
                if (diagnostics.userData && diagnostics.statistics) {
                    diagnostics.systemHealth = 'healthy';
                } else if (diagnostics.userData) {
                    diagnostics.systemHealth = 'partial';
                } else {
                    diagnostics.systemHealth = 'unhealthy';
                }

                // ê²°ê³¼ í‘œì‹œ
                const resultText = `ì‹œìŠ¤í…œ ì§„ë‹¨ ê²°ê³¼:
                
ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ: ${diagnostics.systemHealth === 'healthy' ? 'âœ… ì •ìƒ' : diagnostics.systemHealth === 'partial' ? 'âš ï¸ ë¶€ë¶„ì ' : 'âŒ ë¬¸ì œìˆìŒ'}
ğŸ’¾ LocalStorage ì‚¬ìš©ëŸ‰: ${Math.round(usedSpace / 1024)}KB / ${Math.round(diagnostics.localStorage.total / 1024)}KB
ğŸ‘¤ ì‚¬ìš©ì ë°ì´í„°: ${diagnostics.userData ? 'âœ… ìˆìŒ' : 'âŒ ì—†ìŒ'}
ğŸ“ˆ í†µê³„ ë°ì´í„°: ${diagnostics.statistics ? 'âœ… ìˆìŒ' : 'âŒ ì—†ìŒ'}
ğŸŒ ë¸Œë¼ìš°ì €: ${navigator.userAgent.split(' ')[0]}`;

                alert(resultText);
                console.log('âœ… ì‹œìŠ¤í…œ ì§„ë‹¨ ì™„ë£Œ:', diagnostics);

            } catch (error) {
                console.error('âŒ ì‹œìŠ¤í…œ ì§„ë‹¨ ì‹¤íŒ¨:', error);
                alert('ì‹œìŠ¤í…œ ì§„ë‹¨ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ë°ì´í„° ë¬´ê²°ì„± ê²€ì‚¬
        function testDataIntegrity() {
            try {
                console.log('=== ë°ì´í„° ë¬´ê²°ì„± ê²€ì‚¬ ì‹œì‘ ===');
                
                const results = {
                    userData: { valid: false, errors: [] },
                    statistics: { valid: false, errors: [] },
                    overall: 'unknown'
                };

                // ì‚¬ìš©ì ë°ì´í„° ê²€ì‚¬
                const userData = localStorage.getItem('aicu_user_data');
                if (userData) {
                    try {
                        const user = JSON.parse(userData);
                        if (user.name && user.exam_date) {
                            results.userData.valid = true;
                        } else {
                            results.userData.errors.push('í•„ìˆ˜ í•„ë“œ ëˆ„ë½');
                        }
                    } catch (e) {
                        results.userData.errors.push('JSON íŒŒì‹± ì˜¤ë¥˜');
                    }
                } else {
                    results.userData.errors.push('ë°ì´í„° ì—†ìŒ');
                }

                // í†µê³„ ë°ì´í„° ê²€ì‚¬
                const statisticsData = localStorage.getItem('aicu_statistics');
                if (statisticsData) {
                    try {
                        const stats = JSON.parse(statisticsData);
                        if (stats.meta && stats.stats) {
                            results.statistics.valid = true;
                        } else {
                            results.statistics.errors.push('í•„ìˆ˜ êµ¬ì¡° ëˆ„ë½');
                        }
                    } catch (e) {
                        results.statistics.errors.push('JSON íŒŒì‹± ì˜¤ë¥˜');
                    }
                } else {
                    results.statistics.errors.push('ë°ì´í„° ì—†ìŒ');
                }

                // ì „ì²´ ê²°ê³¼ í‰ê°€
                if (results.userData.valid && results.statistics.valid) {
                    results.overall = 'excellent';
                } else if (results.userData.valid || results.statistics.valid) {
                    results.overall = 'partial';
                } else {
                    results.overall = 'poor';
                }

                // ê²°ê³¼ í‘œì‹œ
                const resultText = `ë°ì´í„° ë¬´ê²°ì„± ê²€ì‚¬ ê²°ê³¼:
                
ğŸ“Š ì „ì²´ ìƒíƒœ: ${results.overall === 'excellent' ? 'âœ… ìš°ìˆ˜' : results.overall === 'partial' ? 'âš ï¸ ë¶€ë¶„ì ' : 'âŒ ë¬¸ì œìˆìŒ'}
ğŸ‘¤ ì‚¬ìš©ì ë°ì´í„°: ${results.userData.valid ? 'âœ… ì •ìƒ' : 'âŒ ì˜¤ë¥˜: ' + results.userData.errors.join(', ')}
ğŸ“ˆ í†µê³„ ë°ì´í„°: ${results.statistics.valid ? 'âœ… ì •ìƒ' : 'âŒ ì˜¤ë¥˜: ' + results.statistics.errors.join(', ')}`;

                alert(resultText);
                console.log('âœ… ë°ì´í„° ë¬´ê²°ì„± ê²€ì‚¬ ì™„ë£Œ:', results);

            } catch (error) {
                console.error('âŒ ë°ì´í„° ë¬´ê²°ì„± ê²€ì‚¬ ì‹¤íŒ¨:', error);
                alert('ë°ì´í„° ë¬´ê²°ì„± ê²€ì‚¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì‹œìŠ¤í…œ ìºì‹œ ì •ë¦¬
        function clearSystemCache() {
            if (confirm('ì‹œìŠ¤í…œ ìºì‹œë¥¼ ì •ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ì„ì‹œ ë°ì´í„°ë§Œ ì •ë¦¬í•˜ë©°, ì¤‘ìš”í•œ ì‚¬ìš©ì ë°ì´í„°ëŠ” ë³´ì¡´ë©ë‹ˆë‹¤.')) {
                try {
                    console.log('=== ì‹œìŠ¤í…œ ìºì‹œ ì •ë¦¬ ì‹œì‘ ===');
                    
                    // ìºì‹œ ê´€ë ¨ í‚¤ë“¤ ì •ë¦¬
                    const cacheKeys = [
                        'aicu_temp_data',
                        'aicu_debug_info',
                        'aicu_test_data',
                        'aicu_cache'
                    ];
                    
                    let clearedCount = 0;
                    cacheKeys.forEach(key => {
                        if (localStorage.getItem(key)) {
                            localStorage.removeItem(key);
                            clearedCount++;
                        }
                    });

                    // ë¸Œë¼ìš°ì € ìºì‹œ ì •ë¦¬ (ê°€ëŠ¥í•œ ê²½ìš°)
                    if ('caches' in window) {
                        caches.keys().then(names => {
                            names.forEach(name => {
                                if (name.includes('aicu')) {
                                    caches.delete(name);
                                }
                            });
                        });
                    }

                    alert(`ì‹œìŠ¤í…œ ìºì‹œ ì •ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.\n\nì •ë¦¬ëœ í•­ëª©: ${clearedCount}ê°œ`);
                    console.log('âœ… ì‹œìŠ¤í…œ ìºì‹œ ì •ë¦¬ ì™„ë£Œ');

                } catch (error) {
                    console.error('âŒ ì‹œìŠ¤í…œ ìºì‹œ ì •ë¦¬ ì‹¤íŒ¨:', error);
                    alert('ì‹œìŠ¤í…œ ìºì‹œ ì •ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }
    </script>
</body>
</html>
