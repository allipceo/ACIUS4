<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACIU S4 - í†µê³„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/static/css/incorrect_analysis.css">
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- í—¤ë” -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">ğŸ“Š í•™ìŠµ í†µê³„</h1>
            <p class="text-gray-600">í•™ìŠµ ì„±ê³¼ ë° ì§„í–‰ ìƒí™©</p>
        </div>

        <!-- ì‚¬ìš©ì ì •ë³´ -->
        <div id="user-info" class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ‘¤ í˜„ì¬ ì‚¬ìš©ì</h2>
            <div id="user-details" class="space-y-2">
                <!-- ì‚¬ìš©ì ì •ë³´ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- í†µê³„ ì¹´ë“œë“¤ -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- ì´ ë¬¸ì œ ìˆ˜ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="text-center">
                    <div class="text-3xl font-bold text-blue-600 mb-2" id="total-questions">0</div>
                    <div class="text-gray-600">ì´ ë¬¸ì œ ìˆ˜</div>
                </div>
            </div>

            <!-- í’€ì´í•œ ë¬¸ì œ ìˆ˜ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="text-center">
                    <div class="text-3xl font-bold text-green-600 mb-2" id="solved-questions">0</div>
                    <div class="text-gray-600">í’€ì´í•œ ë¬¸ì œ</div>
                </div>
            </div>

            <!-- ì •ë‹µë¥  -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="text-center">
                    <div class="text-3xl font-bold text-purple-600 mb-2" id="accuracy-rate">0%</div>
                    <div class="text-gray-600">ì •ë‹µë¥ </div>
                </div>
            </div>

            <!-- í•™ìŠµ ì‹œê°„ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="text-center">
                    <div class="text-3xl font-bold text-orange-600 mb-2" id="study-time">0ë¶„</div>
                    <div class="text-gray-600">ì´ í•™ìŠµ ì‹œê°„</div>
                </div>
            </div>
        </div>

        <!-- ìƒì„¸ í†µê³„ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- ì¹´í…Œê³ ë¦¬ë³„ ì„±ê³¼ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ“ˆ ì¹´í…Œê³ ë¦¬ë³„ ì„±ê³¼</h3>
                <div id="category-stats" class="space-y-3">
                    <!-- ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ìµœê·¼ í•™ìŠµ ê¸°ë¡ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ“ ìµœê·¼ í•™ìŠµ ê¸°ë¡</h3>
                <div id="recent-activity" class="space-y-3">
                    <!-- ìµœê·¼ í™œë™ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- ì˜¤ë‹µ ë¶„ì„ ì„¹ì…˜ -->
        <div class="mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">ğŸ” ì˜¤ë‹µ ë¶„ì„ ë° ê°œì¸ ë§ì¶¤ ì¸ì‚¬ì´íŠ¸</h2>
            
            <!-- ì˜¤ë‹µ ë¶„ì„ ìš”ì•½ -->
            <div id="incorrect-summary-container" class="mb-6">
                <!-- ì˜¤ë‹µ ë¶„ì„ ìš”ì•½ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            
            <!-- ìœ„í—˜ë„ë³„ ë¬¸ì œ ëª©ë¡ -->
            <div id="critical-questions-container" class="mb-6">
                <!-- ìœ„í—˜ë„ë³„ ë¬¸ì œ ëª©ë¡ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            
            <!-- ê³¼ëª©ë³„ ë¶„ì„ -->
            <div id="subject-analysis-container" class="mb-6">
                <!-- ê³¼ëª©ë³„ ë¶„ì„ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            
            <!-- ê°œì¸ ë§ì¶¤ ì¸ì‚¬ì´íŠ¸ -->
            <div id="insights-container" class="mb-6">
                <!-- ê°œì¸ ë§ì¶¤ ì¸ì‚¬ì´íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            
            <!-- í•™ìŠµ ê¶Œì¥ì‚¬í•­ -->
            <div id="recommendations-container" class="mb-6">
                <!-- í•™ìŠµ ê¶Œì¥ì‚¬í•­ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
        <div class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸš€ ì•¡ì…˜</h3>
            <div class="space-y-3">
                <button onclick="startNewSession()" 
                        class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                    ìƒˆë¡œìš´ í•™ìŠµ ì„¸ì…˜ ì‹œì‘
                </button>
                <button onclick="resetStatistics()" 
                        class="w-full bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                    í†µê³„ ì´ˆê¸°í™”
                </button>
                <a href="/home" 
                   class="block w-full bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors text-center">
                    ëŒ€ë¬¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                </a>
            </div>
        </div>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ í†µê³„ í‘œì‹œ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== í†µê³„ í˜ì´ì§€ ë¡œë“œ ===');
            checkUserAndLoadStatistics();
        });

        // ì‚¬ìš©ì í™•ì¸ ë° í†µê³„ ë¡œë“œ
        function checkUserAndLoadStatistics() {
            try {
                const userData = localStorage.getItem('aicu_user_data');
                
                if (userData) {
                    const user = JSON.parse(userData);
                    displayUserInfo(user);
                    loadStatistics();
                } else {
                    console.log('âŒ ì‚¬ìš©ì ì •ë³´ ì—†ìŒ');
                    alert('ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”.');
                    window.location.href = '/register';
                }
                
            } catch (error) {
                console.error('âŒ ì‚¬ìš©ì í™•ì¸ ì‹¤íŒ¨:', error);
                alert('ì‚¬ìš©ì ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                window.location.href = '/register';
            }
        }

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        function displayUserInfo(user) {
            const userDetailsElement = document.getElementById('user-details');
            
            // D-Day ê³„ì‚°
            const examDate = new Date(user.exam_date);
            const today = new Date();
            const timeDiff = examDate.getTime() - today.getTime();
            const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
            const dDayText = daysDiff > 0 ? `D-${daysDiff}` : `D+${Math.abs(daysDiff)}`;
            
            userDetailsElement.innerHTML = `
                <div class="flex justify-between">
                    <span class="font-medium">ì´ë¦„:</span>
                    <span>${user.name}</span>
                </div>
                <div class="flex justify-between">
                    <span class="font-medium">ìœ í˜•:</span>
                    <span class="${user.user_type === 'guest' ? 'text-blue-600' : 'text-green-600'}">
                        ${user.user_type === 'guest' ? 'ê²ŒìŠ¤íŠ¸' : 'ì‹¤ì œ ì‚¬ìš©ì'}
                    </span>
                </div>
                <div class="flex justify-between">
                    <span class="font-medium">D-Day:</span>
                    <span class="font-bold ${daysDiff <= 30 ? 'text-red-600' : 'text-blue-600'}">${dDayText}</span>
                </div>
            `;
        }

        // í†µê³„ ë°ì´í„° ë¡œë“œ
        function loadStatistics() {
            try {
                // LocalStorageì—ì„œ í†µê³„ ë°ì´í„° ë¡œë“œ
                const statsData = localStorage.getItem('aicu_statistics') || '{}';
                const stats = JSON.parse(statsData);
                
                // ê¸°ë³¸ê°’ ì„¤ì •
                const defaultStats = {
                    totalQuestions: 0,
                    solvedQuestions: 0,
                    correctAnswers: 0,
                    studyTime: 0,
                    categories: {},
                    recentActivity: []
                };
                
                const finalStats = { ...defaultStats, ...stats };
                
                // í†µê³„ í‘œì‹œ
                displayStatistics(finalStats);
                
            } catch (error) {
                console.error('âŒ í†µê³„ ë¡œë“œ ì‹¤íŒ¨:', error);
                displayStatistics({
                    totalQuestions: 0,
                    solvedQuestions: 0,
                    correctAnswers: 0,
                    studyTime: 0,
                    categories: {},
                    recentActivity: []
                });
            }
        }

        // í†µê³„ í‘œì‹œ
        function displayStatistics(stats) {
            // ê¸°ë³¸ í†µê³„ í‘œì‹œ
            document.getElementById('total-questions').textContent = stats.totalQuestions;
            document.getElementById('solved-questions').textContent = stats.solvedQuestions;
            
            const accuracyRate = stats.solvedQuestions > 0 
                ? Math.round((stats.correctAnswers / stats.solvedQuestions) * 100) 
                : 0;
            document.getElementById('accuracy-rate').textContent = `${accuracyRate}%`;
            
            document.getElementById('study-time').textContent = `${stats.studyTime}ë¶„`;
            
            // ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ í‘œì‹œ
            displayCategoryStats(stats.categories);
            
            // ìµœê·¼ í™œë™ í‘œì‹œ
            displayRecentActivity(stats.recentActivity);
        }

        // ì¹´í…Œê³ ë¦¬ë³„ í†µê³„ í‘œì‹œ
        function displayCategoryStats(categories) {
            const categoryStatsElement = document.getElementById('category-stats');
            
            if (Object.keys(categories).length === 0) {
                categoryStatsElement.innerHTML = '<p class="text-gray-500">ì•„ì§ ì¹´í…Œê³ ë¦¬ë³„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            let html = '';
            for (const [category, data] of Object.entries(categories)) {
                const accuracy = data.solved > 0 ? Math.round((data.correct / data.solved) * 100) : 0;
                html += `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <div>
                            <div class="font-medium">${category}</div>
                            <div class="text-sm text-gray-600">${data.solved}ë¬¸ì œ í’€ì´</div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-blue-600">${accuracy}%</div>
                            <div class="text-sm text-gray-600">ì •ë‹µë¥ </div>
                        </div>
                    </div>
                `;
            }
            
            categoryStatsElement.innerHTML = html;
        }

        // ìµœê·¼ í™œë™ í‘œì‹œ
        function displayRecentActivity(activities) {
            const recentActivityElement = document.getElementById('recent-activity');
            
            if (activities.length === 0) {
                recentActivityElement.innerHTML = '<p class="text-gray-500">ì•„ì§ í•™ìŠµ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            let html = '';
            activities.slice(0, 5).forEach(activity => {
                const date = new Date(activity.timestamp).toLocaleDateString('ko-KR');
                const time = new Date(activity.timestamp).toLocaleTimeString('ko-KR');
                
                html += `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <div>
                            <div class="font-medium">${activity.action}</div>
                            <div class="text-sm text-gray-600">${date} ${time}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold text-green-600">${activity.result}</div>
                        </div>
                    </div>
                `;
            });
            
            recentActivityElement.innerHTML = html;
        }

        // ìƒˆë¡œìš´ í•™ìŠµ ì„¸ì…˜ ì‹œì‘
        function startNewSession() {
            // ê¸°ë³¸ í•™ìŠµ í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = '/basic-learning';
        }

        // í†µê³„ ì´ˆê¸°í™”
        function resetStatistics() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  í†µê³„ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    // LocalStorageì—ì„œ í†µê³„ ë°ì´í„° ì‚­ì œ
                    localStorage.removeItem('aicu_statistics');
                    
                    // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                    location.reload();
                    
                } catch (error) {
                    console.error('í†µê³„ ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    alert('í†µê³„ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }
    </script>
    
    <!-- Week3 ì˜¤ë‹µ ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸ -->
    <script src="/static/js/incorrect_analysis.js"></script>
</body>
</html>
