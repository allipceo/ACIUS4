<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACIU S4 - ì„¤ì •</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- í—¤ë” -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">âš™ï¸ ì‚¬ìš©ì ì„¤ì •</h1>
            <p class="text-gray-600">ì‚¬ìš©ì ì •ë³´ ë° ì‹œìŠ¤í…œ ì„¤ì •</p>
        </div>

        <!-- í˜„ì¬ ì‚¬ìš©ì ì •ë³´ -->
        <div id="current-user-info" class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ‘¤ í˜„ì¬ ì‚¬ìš©ì ì •ë³´</h2>
            <div id="user-details" class="space-y-3">
                <!-- ì‚¬ìš©ì ì •ë³´ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ì„¤ì • ì˜µì…˜ë“¤ -->
        <div class="max-w-2xl mx-auto space-y-6">
            <!-- ì‚¬ìš©ì ì •ë³´ ìˆ˜ì • -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">âœï¸ ì‚¬ìš©ì ì •ë³´ ìˆ˜ì •</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì´ë¦„</label>
                        <input type="text" id="edit-name" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì „í™”ë²ˆí˜¸</label>
                        <input type="tel" id="edit-phone" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì‹œí—˜ì¼ì</label>
                        <input type="date" id="edit-exam-date" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <button onclick="updateUserInfo()" 
                            class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                        ì •ë³´ ìˆ˜ì •
                    </button>
                </div>
            </div>

            <!-- í•™ìŠµ ì„¤ì • -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ“š í•™ìŠµ ì„¤ì •</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì¼ì¼ ëª©í‘œ ë¬¸ì œìˆ˜</label>
                        <select id="daily-goal" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="10">10ë¬¸ì œ</option>
                            <option value="20">20ë¬¸ì œ</option>
                            <option value="30">30ë¬¸ì œ</option>
                            <option value="50" selected>50ë¬¸ì œ (ê¶Œì¥)</option>
                            <option value="100">100ë¬¸ì œ</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì„ í˜¸ í•™ìŠµì‹œê°„</label>
                        <select id="study-time" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="morning">ì˜¤ì „ (09:00-12:00)</option>
                            <option value="afternoon" selected>ì˜¤í›„ (13:00-18:00)</option>
                            <option value="evening">ì €ë… (19:00-22:00)</option>
                            <option value="night">ë°¤ (22:00-01:00)</option>
                        </select>
                    </div>
                    <button onclick="updateLearningSettings()" 
                            class="w-full bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                        í•™ìŠµ ì„¤ì • ì €ì¥
                    </button>
                </div>
            </div>

            <!-- ë°ì´í„° ê´€ë¦¬ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">ğŸ—‚ï¸ ë°ì´í„° ê´€ë¦¬</h3>
                <div class="space-y-4">
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                        <p class="text-yellow-800 text-sm">
                            <strong>ì£¼ì˜:</strong> ë°ì´í„° ì´ˆê¸°í™”ëŠ” ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì‹ ì¤‘íˆ ì„ íƒí•´ ì£¼ì„¸ìš”.
                        </p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button onclick="resetStatistics()" 
                                class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg transition-colors">
                            ğŸ“Š í†µê³„ ë°ì´í„° ì´ˆê¸°í™”
                        </button>
                        <button onclick="resetAllData()" 
                                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors">
                            ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”
                        </button>
                    </div>
                </div>
            </div>

            <!-- ì‹œìŠ¤í…œ ì •ë³´ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">â„¹ï¸ ì‹œìŠ¤í…œ ì •ë³´</h3>
                <div class="space-y-2 text-sm text-gray-600">
                    <div class="flex justify-between">
                        <span>ì‹œìŠ¤í…œ ë²„ì „:</span>
                        <span>AICU S4 v3.6</span>
                    </div>
                    <div class="flex justify-between">
                        <span>ì‚¬ìš©ì ë“±ë¡ ë°©ì‹:</span>
                        <span>LocalStorage ê¸°ë°˜</span>
                    </div>
                    <div class="flex justify-between">
                        <span>ë°ì´í„° ì €ì¥ ìœ„ì¹˜:</span>
                        <span>ë¸Œë¼ìš°ì € ë¡œì»¬</span>
                    </div>
                    <div class="flex justify-between">
                        <span>ë“±ë¡ ìƒíƒœ:</span>
                        <span id="registration-status" class="font-medium">í™•ì¸ ì¤‘...</span>
                    </div>
                </div>
            </div>

            <!-- ì•¡ì…˜ ë²„íŠ¼ë“¤ -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <a href="/home" 
                       class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors text-center">
                        ğŸ  ëŒ€ë¬¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°
                    </a>
                    <button onclick="exportUserData()" 
                            class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-colors">
                        ğŸ“¤ ì‚¬ìš©ì ë°ì´í„° ë‚´ë³´ë‚´ê¸°
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== ì„¤ì • í˜ì´ì§€ ë¡œë“œ ===');
            loadUserInfo();
            loadLearningSettings();
        });

        // ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ë° í‘œì‹œ
        function loadUserInfo() {
            try {
                const userData = localStorage.getItem('aicu_user_data');
                
                if (userData) {
                    const user = JSON.parse(userData);
                    displayUserInfo(user);
                    populateEditForm(user);
                    document.getElementById('registration-status').textContent = 'ë“±ë¡ë¨';
                    document.getElementById('registration-status').className = 'font-medium text-green-600';
                } else {
                    console.log('âŒ ì‚¬ìš©ì ì •ë³´ ì—†ìŒ');
                    document.getElementById('registration-status').textContent = 'ë¯¸ë“±ë¡';
                    document.getElementById('registration-status').className = 'font-medium text-red-600';
                    alert('ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ë“±ë¡í•´ì£¼ì„¸ìš”.');
                    window.location.href = '/register';
                }
                
            } catch (error) {
                console.error('âŒ ì‚¬ìš©ì ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                window.location.href = '/register';
            }
        }

        // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
        function displayUserInfo(user) {
            const userDetailsElement = document.getElementById('user-details');
            
            // D-Day ê³„ì‚°
            const examDate = new Date(user.exam_date);
            const today = new Date();
            const timeDiff = examDate.getTime() - today.getTime();
            const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
            const dDayText = daysDiff > 0 ? `D-${daysDiff}` : `D+${Math.abs(daysDiff)}`;
            
            userDetailsElement.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="font-medium">ì´ë¦„:</span>
                            <span>${user.name}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ìœ í˜•:</span>
                            <span class="${user.user_type === 'guest' ? 'text-blue-600' : 'text-green-600'} font-medium">
                                ${user.user_type === 'guest' ? 'ê²ŒìŠ¤íŠ¸' : 'ì‹¤ì œ ì‚¬ìš©ì'}
                            </span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ì „í™”ë²ˆí˜¸:</span>
                            <span>${user.phone || 'ë¯¸ì…ë ¥'}</span>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="font-medium">ì‹œí—˜:</span>
                            <span>${user.exam_subject}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ì‹œí—˜ì¼:</span>
                            <span>${user.exam_date}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">D-Day:</span>
                            <span class="font-bold ${daysDiff <= 30 ? 'text-red-600' : 'text-blue-600'}">${dDayText}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="font-medium">ë“±ë¡ì¼:</span>
                            <span>${user.registration_date}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // ìˆ˜ì • í¼ì— ì‚¬ìš©ì ì •ë³´ ì±„ìš°ê¸°
        function populateEditForm(user) {
            document.getElementById('edit-name').value = user.name;
            document.getElementById('edit-phone').value = user.phone || '';
            document.getElementById('edit-exam-date').value = user.exam_date;
        }

        // ì‚¬ìš©ì ì •ë³´ ìˆ˜ì •
        async function updateUserInfo() {
            try {
                const userData = localStorage.getItem('aicu_user_data');
                if (!userData) {
                    alert('ì‚¬ìš©ì ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                const user = JSON.parse(userData);
                const newName = document.getElementById('edit-name').value.trim();
                const newPhone = document.getElementById('edit-phone').value.trim();
                const newExamDate = document.getElementById('edit-exam-date').value;

                // ì…ë ¥ê°’ ê²€ì¦
                if (!newName || newName.length < 2) {
                    alert('ì´ë¦„ì„ 2ê¸€ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                if (!newExamDate) {
                    alert('ì‹œí—˜ì¼ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }

                // ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
                const updatedUser = {
                    ...user,
                    name: newName,
                    phone: newPhone,
                    exam_date: newExamDate,
                    updated_at: new Date().toISOString()
                };

                // LocalStorageì— ì €ì¥
                localStorage.setItem('aicu_user_data', JSON.stringify(updatedUser));

                // í™”ë©´ ì—…ë°ì´íŠ¸
                displayUserInfo(updatedUser);

                alert('ì‚¬ìš©ì ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.');
                console.log('âœ… ì‚¬ìš©ì ì •ë³´ ìˆ˜ì • ì™„ë£Œ:', updatedUser);

            } catch (error) {
                console.error('âŒ ì‚¬ìš©ì ì •ë³´ ìˆ˜ì • ì‹¤íŒ¨:', error);
                alert('ì‚¬ìš©ì ì •ë³´ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í•™ìŠµ ì„¤ì • ë¡œë“œ
        function loadLearningSettings() {
            try {
                const settingsData = localStorage.getItem('aicu_learning_settings');
                if (settingsData) {
                    const settings = JSON.parse(settingsData);
                    document.getElementById('daily-goal').value = settings.dailyGoal || '50';
                    document.getElementById('study-time').value = settings.studyTime || 'afternoon';
                }
            } catch (error) {
                console.error('âŒ í•™ìŠµ ì„¤ì • ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // í•™ìŠµ ì„¤ì • ì €ì¥
        function updateLearningSettings() {
            try {
                const dailyGoal = document.getElementById('daily-goal').value;
                const studyTime = document.getElementById('study-time').value;

                const settings = {
                    dailyGoal: dailyGoal,
                    studyTime: studyTime,
                    updated_at: new Date().toISOString()
                };

                localStorage.setItem('aicu_learning_settings', JSON.stringify(settings));
                alert('í•™ìŠµ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                console.log('âœ… í•™ìŠµ ì„¤ì • ì €ì¥ ì™„ë£Œ:', settings);

            } catch (error) {
                console.error('âŒ í•™ìŠµ ì„¤ì • ì €ì¥ ì‹¤íŒ¨:', error);
                alert('í•™ìŠµ ì„¤ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // í†µê³„ ë°ì´í„° ì´ˆê¸°í™”
        function resetStatistics() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  í†µê³„ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                try {
                    localStorage.removeItem('aicu_statistics');
                    localStorage.removeItem('aicu_quiz_progress');
                    localStorage.removeItem('aicu_learning_history');
                    alert('í†µê³„ ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
                    console.log('âœ… í†µê³„ ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ');
                } catch (error) {
                    console.error('âŒ í†µê³„ ë°ì´í„° ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    alert('í†µê³„ ë°ì´í„° ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }

        // ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”
        function resetAllData() {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë©°, ì‚¬ìš©ì ì •ë³´ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.')) {
                try {
                    // ëª¨ë“  AICU ê´€ë ¨ ë°ì´í„° ì‚­ì œ
                    const keysToRemove = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key && key.startsWith('aicu_')) {
                            keysToRemove.push(key);
                        }
                    }
                    
                    keysToRemove.forEach(key => localStorage.removeItem(key));
                    
                    alert('ëª¨ë“  ë°ì´í„°ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë“±ë¡í•´ì£¼ì„¸ìš”.');
                    console.log('âœ… ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ');
                    
                    // ë“±ë¡ í˜ì´ì§€ë¡œ ì´ë™
                    window.location.href = '/register';
                    
                } catch (error) {
                    console.error('âŒ ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                    alert('ë°ì´í„° ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            }
        }

        // ì‚¬ìš©ì ë°ì´í„° ë‚´ë³´ë‚´ê¸°
        function exportUserData() {
            try {
                const userData = localStorage.getItem('aicu_user_data');
                const statisticsData = localStorage.getItem('aicu_statistics');
                const learningSettings = localStorage.getItem('aicu_learning_settings');
                
                const exportData = {
                    user: userData ? JSON.parse(userData) : null,
                    statistics: statisticsData ? JSON.parse(statisticsData) : null,
                    learningSettings: learningSettings ? JSON.parse(learningSettings) : null,
                    exportDate: new Date().toISOString()
                };

                const dataStr = JSON.stringify(exportData, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `aicu_user_data_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                
                alert('ì‚¬ìš©ì ë°ì´í„°ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
                console.log('âœ… ì‚¬ìš©ì ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ì‚¬ìš©ì ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨:', error);
                alert('ë°ì´í„° ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
    </script>
</body>
</html>
