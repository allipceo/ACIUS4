<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACIU S4 - ê¸°ë³¸í•™ìŠµ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- í—¤ë” -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-blue-600 mb-2">ACIU QUIZ</h1>
            <p class="text-gray-600">ë³´í—˜ì¤‘ê°œì‚¬ ìê²©ì¦ í•™ìŠµ ì‹œìŠ¤í…œ - Season 4</p>
            <div id="status" class="text-center text-blue-600 mb-4 font-semibold">ê¸°ë³¸í•™ìŠµ ëª¨ë“œ</div>
        </header>

        <!-- ê¸°ë³¸í•™ìŠµ í™”ë©´ -->
        <div id="basic-learning-screen" class="bg-white rounded-lg shadow-md p-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold">ê¸°ë³¸í•™ìŠµ</h2>
                
                <!-- í†µê³„ ì‹œìŠ¤í…œ í†µí•©ëœ í†µê³„ ë°•ìŠ¤ -->
                <div id="basic-progress-box" class="bg-gradient-to-r from-blue-50 to-indigo-50 p-4 rounded-lg border border-blue-200 min-w-[300px]">
                    <!-- ì§„í–‰ë¥  ì •ë³´ -->
                    <div class="mb-2">
                        <span class="text-sm font-medium text-gray-700">ì§„í–‰ë¥ :</span>
                        <span id="basic-progress-text" class="ml-2 text-sm font-bold text-blue-600">ë¡œë”© ì¤‘...</span>
                    </div>
                    <!-- ì •ë‹µë¥  ì •ë³´ -->
                    <div class="mb-2">
                        <span class="text-sm font-medium text-gray-700">ì •ë‹µë¥ :</span>
                        <span id="basic-accuracy-text" class="ml-2 text-sm font-bold text-green-600">ë¡œë”© ì¤‘...</span>
                    </div>
                    <!-- ì˜¤ëŠ˜ ì •ë‹µë¥  -->
                    <div>
                        <span class="text-sm font-medium text-gray-700">ì˜¤ëŠ˜ ì •ë‹µë¥ :</span>
                        <span id="basic-today-accuracy" class="ml-2 text-sm font-bold text-purple-600">ë¡œë”© ì¤‘...</span>
                    </div>
                </div>
                
                <button onclick="goHome()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">
                    í™ˆìœ¼ë¡œ
                </button>
            </div>
            
            <!-- ë‹¤ìŒ ë¬¸ì œ ì•ˆë‚´ ë°•ìŠ¤ -->
            <div id="next-question-box" class="mb-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                <h3 class="text-lg font-semibold text-yellow-800 mb-2">ğŸ“ ë‹¤ìŒ ë¬¸ì œ ì•ˆë‚´</h3>
                <p id="next-question-text" class="text-sm text-yellow-700">ë¡œë”© ì¤‘...</p>
            </div>
            
            <!-- í•™ìŠµ ë°©ì‹ ì„ íƒ -->
            <div class="mb-8" id="mode-selection">
                <h3 class="text-lg font-semibold mb-4">í•™ìŠµ ë°©ì‹ ì„ íƒ</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="selectBasicLearningMode('continue')" class="bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-lg text-center transition-all">
                        <div class="text-2xl mb-2">ğŸ”„</div>
                        <div class="font-semibold">ì´ì–´í’€ê¸°</div>
                        <div class="text-sm opacity-90">ì´ì „ ì§„í–‰ìƒí™©ë¶€í„° ê³„ì†</div>
                    </button>
                    <button onclick="selectBasicLearningMode('restart')" class="bg-green-500 hover:bg-green-600 text-white p-4 rounded-lg text-center transition-all">
                        <div class="text-2xl mb-2">ğŸ”„</div>
                        <div class="font-semibold">ì²˜ìŒí’€ê¸°</div>
                        <div class="text-sm opacity-90">ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘</div>
                    </button>
                    <button onclick="selectBasicLearningMode('random')" class="bg-purple-500 hover:bg-purple-600 text-white p-4 rounded-lg text-center transition-all">
                        <div class="text-2xl mb-2">ğŸ²</div>
                        <div class="font-semibold">ëœë¤í’€ê¸°</div>
                        <div class="text-sm opacity-90">ë¬´ì‘ìœ„ ìˆœì„œë¡œ í•™ìŠµ</div>
                    </button>
                </div>
            </div>
            
            <!-- ê¸°ë³¸í•™ìŠµ ë¬¸ì œ í‘œì‹œ ì˜ì—­ -->
            <div id="basic-question-area" class="hidden">
                <h3 class="text-lg font-semibold mb-4">ë¬¸ì œ í’€ì´</h3>
                
                <!-- ë¬¸ì œ ì •ë³´ -->
                <div class="mb-4 p-4 bg-gray-50 rounded">
                    <div class="flex justify-between items-center mb-2">
                        <span id="question-type" class="text-sm text-blue-600 font-medium">ì§„ìœ„í˜•</span>
                        <span id="question-code" class="text-sm text-gray-600">Q001</span>
                    </div>
                    <div id="layer-info" class="text-sm text-gray-500 mb-2">ì¬ì‚°ë³´í—˜ > ì¼ë°˜ì¬ì‚°ë³´í—˜</div>
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-sm text-gray-600">ì§„ë„</span>
                        <span id="progress-info" class="text-sm font-medium text-blue-600">1 / 100</span>
                    </div>
                    <div id="question-text" class="text-lg font-medium">ë¬¸ì œ í…ìŠ¤íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
                </div>
                
                <!-- ë‹µì•ˆ ë²„íŠ¼ ì˜ì—­ -->
                <div id="answer-buttons" class="mb-4">
                    <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ë‹µì•ˆ ë²„íŠ¼ë“¤ -->
                </div>
                
                <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
                <div id="result-area" class="hidden">
                    <div id="result-message" class="p-3 rounded font-medium"></div>
                </div>
                
                <!-- ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ -->
                <div class="flex justify-between mt-4">
                    <button id="prev-button" onclick="prevQuestion('basic')" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg">
                        ì´ì „ ë¬¸ì œ
                    </button>
                    <button id="check-button" onclick="checkAnswer('basic')" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">
                        ì •ë‹µ í™•ì¸
                    </button>
                    <button id="next-button" onclick="nextQuestion('basic')" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">
                        ë‹¤ìŒ ë¬¸ì œ
                    </button>
                </div>
                
                <!-- ìƒì„¸ í†µê³„ í™•ì¥ ì˜ì—­ -->
                <div class="mt-6 bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold mb-3">ìƒì„¸ í†µê³„</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                        <div class="bg-white p-3 rounded">
                            <div class="text-2xl font-bold text-blue-600" id="total-questions">0</div>
                            <div class="text-xs text-gray-600">ì „ì²´ ë¬¸ì œ</div>
                        </div>
                        <div class="bg-white p-3 rounded">
                            <div class="text-2xl font-bold text-green-600" id="correct-answers">0</div>
                            <div class="text-xs text-gray-600">ì •ë‹µ</div>
                        </div>
                        <div class="bg-white p-3 rounded">
                            <div class="text-2xl font-bold text-red-600" id="wrong-answers">0</div>
                            <div class="text-xs text-gray-600">ì˜¤ë‹µ</div>
                        </div>
                        <div class="bg-white p-3 rounded">
                            <div class="text-2xl font-bold text-purple-600" id="current-streak">0</div>
                            <div class="text-xs text-gray-600">ì—°ì† ì •ë‹µ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- í†µê³„ ì‹œìŠ¤í…œ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ -->
    <script src="/static/js/progress_manager.js"></script>
    <script src="/static/js/stats_calculator.js"></script>
    <script src="/static/js/ui_updater.js"></script>
    <script src="/static/js/progress_system.js"></script>
    
    <!-- JavaScript ëª¨ë“ˆ ë¡œë“œ (ìˆœì„œ ì¤‘ìš”) -->
    <script src="/static/js/basic_learning_core.js"></script>
    <script src="/static/js/basic_learning_ui.js"></script>
    <script src="/static/js/basic_learning_stats.js"></script>
    <script src="/static/js/basic_learning_main.js"></script>
    
    <!-- í†µê³„ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
        // í†µê³„ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ë° ì—…ë°ì´íŠ¸
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ¯ ê¸°ë³¸í•™ìŠµ í˜ì´ì§€ í†µê³„ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹œì‘...');
            
            // ProgressSystem ì´ˆê¸°í™” ëŒ€ê¸°
            setTimeout(() => {
                if (typeof progressSystem !== 'undefined') {
                    // ì‹œìŠ¤í…œ ì´ˆê¸°í™”
                    const initResult = progressSystem.initialize();
                    if (initResult) {
                        console.log('âœ… ê¸°ë³¸í•™ìŠµ í˜ì´ì§€ í†µê³„ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
                        
                        // ê¸°ë³¸í•™ìŠµ í†µê³„ ì—…ë°ì´íŠ¸
                        progressSystem.updateStats('basic');
                        
                        // ë‹¤ìŒ ë¬¸ì œ ì•ˆë‚´ ì—…ë°ì´íŠ¸
                        const nextQuestion = progressSystem.getNextQuestion('basic');
                        const nextQuestionText = document.getElementById('next-question-text');
                        if (nextQuestionText) {
                            nextQuestionText.textContent = `ë‹¤ìŒ ë¬¸ì œ: ${nextQuestion}ë²ˆ`;
                        }
                        
                        console.log('âœ… ê¸°ë³¸í•™ìŠµ í˜ì´ì§€ í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                    } else {
                        console.error('âŒ ê¸°ë³¸í•™ìŠµ í˜ì´ì§€ í†µê³„ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨');
                    }
                } else {
                    console.error('âŒ ProgressSystem ëª¨ë“ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
            }, 1000);
        });
        
        // ì´ì–´í’€ê¸° ê¸°ëŠ¥ êµ¬í˜„
        function selectBasicLearningMode(mode) {
            console.log(`ğŸ¯ ê¸°ë³¸í•™ìŠµ ëª¨ë“œ ì„ íƒ: ${mode}`);
            
            if (mode === 'continue') {
                // ì´ì–´í’€ê¸°: ProgressSystemì—ì„œ ë‹¤ìŒ ë¬¸ì œ ì¡°íšŒ
                if (typeof progressSystem !== 'undefined' && progressSystem.isInitialized) {
                    const nextQuestion = progressSystem.getNextQuestion('basic');
                    console.log(`ğŸ”„ ì´ì–´í’€ê¸°: ${nextQuestion}ë²ˆ ë¬¸ì œë¶€í„° ì‹œì‘`);
                    
                    // ê¸°ì¡´ ê¸°ë³¸í•™ìŠµ ë¡œì§ê³¼ í†µí•©
                    if (typeof startBasicLearning === 'function') {
                        startBasicLearning(nextQuestion);
                    } else {
                        console.log('âš ï¸ ê¸°ë³¸í•™ìŠµ ì‹œì‘ í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    }
                } else {
                    console.log('âš ï¸ í†µê³„ ì‹œìŠ¤í…œì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì²˜ìŒë¶€í„° ì‹œì‘í•©ë‹ˆë‹¤.');
                    if (typeof startBasicLearning === 'function') {
                        startBasicLearning(1);
                    }
                }
            } else if (mode === 'restart') {
                // ì²˜ìŒí’€ê¸°: 1ë²ˆ ë¬¸ì œë¶€í„° ì‹œì‘
                console.log('ğŸ”„ ì²˜ìŒí’€ê¸°: 1ë²ˆ ë¬¸ì œë¶€í„° ì‹œì‘');
                if (typeof startBasicLearning === 'function') {
                    startBasicLearning(1);
                }
            } else if (mode === 'random') {
                // ëœë¤í’€ê¸°: ë¬´ì‘ìœ„ ë¬¸ì œ ì„ íƒ
                const randomQuestion = Math.floor(Math.random() * 789) + 1;
                console.log(`ğŸ² ëœë¤í’€ê¸°: ${randomQuestion}ë²ˆ ë¬¸ì œë¶€í„° ì‹œì‘`);
                if (typeof startBasicLearning === 'function') {
                    startBasicLearning(randomQuestion);
                }
            }
            
            // ëª¨ë“œ ì„ íƒ í™”ë©´ ìˆ¨ê¸°ê¸°
            document.getElementById('mode-selection').classList.add('hidden');
            document.getElementById('basic-question-area').classList.remove('hidden');
        }
        
        // ì •ë‹µ í™•ì¸ ì‹œ í†µê³„ ì—…ë°ì´íŠ¸
        function checkAnswerWithStats(mode, questionNumber, isCorrect) {
            console.log(`âœ… ì •ë‹µ í™•ì¸: ${mode} - Q${questionNumber} - ${isCorrect ? 'ì •ë‹µ' : 'ì˜¤ë‹µ'}`);
            
            // ProgressSystemì— ì§„ë„ ì €ì¥
            if (typeof progressSystem !== 'undefined' && progressSystem.isInitialized) {
                const saveResult = progressSystem.saveProgress(mode, questionNumber, isCorrect);
                if (saveResult) {
                    console.log('âœ… ì§„ë„ ì €ì¥ ì™„ë£Œ');
                    
                    // í†µê³„ ì—…ë°ì´íŠ¸
                    progressSystem.updateStats(mode);
                    
                    // ë‹¤ìŒ ë¬¸ì œ ì•ˆë‚´ ì—…ë°ì´íŠ¸
                    const nextQuestion = progressSystem.getNextQuestion(mode);
                    const nextQuestionText = document.getElementById('next-question-text');
                    if (nextQuestionText) {
                        nextQuestionText.textContent = `ë‹¤ìŒ ë¬¸ì œ: ${nextQuestion}ë²ˆ`;
                    }
                } else {
                    console.error('âŒ ì§„ë„ ì €ì¥ ì‹¤íŒ¨');
                }
            }
            
            // ê¸°ì¡´ ì •ë‹µ í™•ì¸ ë¡œì§ ì‹¤í–‰
            if (typeof checkAnswer === 'function') {
                checkAnswer(mode);
            }
        }
        
        // ê¸°ì¡´ checkAnswer í•¨ìˆ˜ë¥¼ ìƒˆë¡œìš´ í•¨ìˆ˜ë¡œ êµì²´
        if (typeof checkAnswer === 'function') {
            const originalCheckAnswer = checkAnswer;
            window.checkAnswer = function(mode) {
                // í˜„ì¬ ë¬¸ì œ ë²ˆí˜¸ì™€ ì •ë‹µ ì—¬ë¶€ë¥¼ ê°€ì ¸ì™€ì„œ í†µê³„ ì—…ë°ì´íŠ¸
                // (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” í˜„ì¬ ë¬¸ì œ ì •ë³´ë¥¼ ê°€ì ¸ì™€ì•¼ í•¨)
                const currentQuestion = getCurrentQuestionNumber(); // ì´ í•¨ìˆ˜ëŠ” ê¸°ì¡´ ì½”ë“œì—ì„œ êµ¬í˜„ í•„ìš”
                const isCorrect = getCurrentAnswerResult(); // ì´ í•¨ìˆ˜ëŠ” ê¸°ì¡´ ì½”ë“œì—ì„œ êµ¬í˜„ í•„ìš”
                
                checkAnswerWithStats(mode, currentQuestion, isCorrect);
            };
        }
    </script>
</body>
</html>