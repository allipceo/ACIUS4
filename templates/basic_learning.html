<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACIU S4 - ê¸°ë³¸í•™ìŠµ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ê³µí†µ ì»´í¬ë„ŒíŠ¸ CSS -->
    <link rel="stylesheet" href="/static/css/question_ui.css">
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- í—¤ë” -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-blue-600 mb-2">ACIU QUIZ</h1>
            <p class="text-gray-600">ë³´í—˜ì¤‘ê°œì‚¬ ìê²©ì¦ í•™ìŠµ ì‹œìŠ¤í…œ - Season 4</p>
            <div id="status" class="text-center text-blue-600 mb-4 font-semibold">ê¸°ë³¸í•™ìŠµ ëª¨ë“œ</div>
            <div id="category-info" class="text-center text-green-600 mb-2 font-medium hidden">
                <!-- ì¹´í…Œê³ ë¦¬ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </header>

        <!-- ê¸°ë³¸í•™ìŠµ í™”ë©´ -->
        <div id="basic-learning-screen" class="bg-white rounded-lg shadow-md p-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-semibold" id="learning-title">ê¸°ë³¸í•™ìŠµ</h2>
                
                <button id="navigation-button" onclick="goToHome()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">
                    í™ˆìœ¼ë¡œ
                </button>
            </div>
            

            
            <!-- í•™ìŠµ ë°©ì‹ ì„ íƒ -->
            <div class="mb-8" id="mode-selection">
                <h3 class="text-lg font-semibold mb-4">í•™ìŠµ ë°©ì‹ ì„ íƒ</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button onclick="selectBasicLearningMode('continue')" class="bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-lg text-center transition-all">
                        <div class="text-2xl mb-2">ğŸ”„</div>
                        <div class="font-semibold">ì´ì–´í’€ê¸°</div>
                        <div class="text-sm opacity-90">ì´ì „ ì§„í–‰ìƒí™©ë¶€í„° ê³„ì†</div>
                    </button>
                    <button onclick="selectBasicLearningMode('restart')" class="bg-green-500 hover:bg-green-600 text-white p-4 rounded-lg text-center transition-all">
                        <div class="text-2xl mb-2">ğŸ”„</div>
                        <div class="font-semibold">ì²˜ìŒí’€ê¸°</div>
                        <div class="text-sm opacity-90">ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘</div>
                    </button>
                    <button onclick="selectBasicLearningMode('random')" class="bg-purple-500 hover:bg-purple-600 text-white p-4 rounded-lg text-center transition-all">
                        <div class="text-2xl mb-2">ğŸ²</div>
                        <div class="font-semibold">ëœë¤í’€ê¸°</div>
                        <div class="text-sm opacity-90">ë¬´ì‘ìœ„ ìˆœì„œë¡œ í•™ìŠµ</div>
                    </button>
                </div>
            </div>
            
            <!-- ë¬¸ì œ í‘œì‹œ ì˜ì—­ (V5.0 ì—…ê·¸ë ˆì´ë“œ) -->
            <div id="basic-question-area" class="hidden">
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h2 class="text-2xl font-semibold mb-3 flex items-center">
                        <svg class="w-8 h-8 mr-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        ë¬¸ì œ í’€ì´
                    </h2>
                    
                    <!-- V5.0 ëª¨ë“ˆì‹ ì»´í¬ë„ŒíŠ¸ë“¤ -->
                    <!-- ë¬¸ì œì •ë³´ ëª¨ë“ˆ (ê¸°ì¡´ DOM ID ëª¨ë‘ ë³´ì¡´) -->
                    <div id="question-info-module">
                        <!-- ë¬¸ì œ ì •ë³´ í‘œì‹œ ì»¨í…Œì´ë„ˆ -->
                        <div class="mb-3 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg border border-blue-200 shadow-sm">
                            <!-- ë¬¸ì œ í—¤ë” ì •ë³´ -->
                            <div class="flex justify-between items-center mb-3">
                                <!-- ë¬¸ì œ íƒ€ì…ê³¼ ë ˆì´ì–´ ì •ë³´ í†µí•© (1í–‰) -->
                                <div class="flex items-center space-x-4">
                                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
                                        <span class="w-2 h-2 bg-blue-600 rounded-full mr-2"></span>
                                        <span id="question-type">ì§„ìœ„í˜•</span>
                                    </span>
                                    <span class="text-sm text-gray-600">
                                        <span id="layer-info" class="font-medium">ì¬ì‚°ë³´í—˜ > ì¼ë°˜ì¬ì‚°ë³´í—˜</span>
                                    </span>
                                </div>
                                
                                <!-- ë¬¸ì œ ì½”ë“œ (ê¸°ì¡´ DOM ID ìœ ì§€) -->
                                <div class="text-sm text-gray-600 font-mono bg-gray-100 px-3 py-1 rounded">
                                    <span class="text-gray-500">Q</span><span id="question-code">001</span>
                                </div>
                            </div>
                            
                            <!-- ê¸ˆì¼/ëˆ„ì  í†µê³„ ì •ë³´ (2í–‰, 3í–‰) -->
                            <div class="space-y-2">
                                <!-- 2í–‰: ê¸ˆì¼í†µê³„ -->
                                <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg border border-green-100">
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        <span class="text-sm font-medium text-green-700">ê¸ˆì¼í†µê³„</span>
                                    </div>
                                    <div class="flex items-center space-x-4">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-sm font-medium text-gray-700">ê¸ˆì¼ í‘¼ ë¬¸ì œìˆ˜:</span>
                                            <span id="daily-questions-solved" class="text-sm font-bold text-green-600">0</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-sm font-medium text-gray-700">ê¸ˆì¼ ì •ë‹µë¥ :</span>
                                            <span id="daily-accuracy" class="text-sm font-bold text-green-600">0%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- 3í–‰: ëˆ„ì í†µê³„ -->
                                <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg border border-blue-100">
                                    <div class="flex items-center space-x-2">
                                        <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                        </svg>
                                        <span class="text-sm font-medium text-blue-700">ëˆ„ì í†µê³„</span>
                                    </div>
                                    <div class="flex items-center space-x-4">
                                        <div class="flex items-center space-x-2">
                                            <span class="text-sm font-medium text-gray-700">ëˆ„ì  í‘¼ ë¬¸ì œìˆ˜:</span>
                                            <span id="cumulative-questions-solved" class="text-sm font-bold text-blue-600">0</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-sm font-medium text-gray-700">ëˆ„ì  ì •ë‹µë¥ :</span>
                                            <span id="cumulative-accuracy" class="text-sm font-bold text-blue-600">0%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ë¬¸ì œë‚´ìš© ëª¨ë“ˆ (ê¸°ì¡´ DOM ID ë³´ì¡´) -->
                    <div id="question-content-module">
                        <div class="mb-3 bg-white rounded-lg shadow-lg border border-gray-200 overflow-hidden">
                            <div class="px-4 py-3 bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200">
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 mr-3 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    <h3 class="text-lg font-semibold text-gray-800">ë¬¸ì œ</h3>
                                </div>
                            </div>
                            
                            <div class="p-4">
                                <div id="question-text" class="text-lg leading-relaxed text-gray-800 font-medium min-h-[100px] 
                                            bg-gradient-to-r from-yellow-50 to-orange-50 p-4 rounded-lg border-l-4 border-orange-400 
                                            shadow-inner whitespace-pre-line">
                                    ë¬¸ì œ í…ìŠ¤íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ë‹µì•ˆë²„íŠ¼ ëª¨ë“ˆ (ê¸°ì¡´ DOM ID ë³´ì¡´) -->
                    <div id="answer-buttons-module">
                        <div class="mb-3">
                            <div class="mb-2 flex items-center justify-between">
                                <div class="flex items-center">
                                    <svg class="w-5 h-5 mr-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                              d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h2m0-12h10a2 2 0 012 2v10a2 2 0 01-2 2H9m0-12V3a2 2 0 012-2h2a2 2 0 012 2v2M9 5v12"></path>
                                    </svg>
                                    <h3 class="text-lg font-semibold text-gray-800">ë‹µì•ˆ ì„ íƒ</h3>
                                </div>
                            </div>
                            
                            <!-- ë‹µì•ˆ ë²„íŠ¼ ì˜ì—­ (ê¸°ì¡´ DOM ID ìœ ì§€) -->
                            <div id="answer-buttons" class="space-y-3">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ë‹µì•ˆ ë²„íŠ¼ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                            </div>
                        </div>
                    </div>

                    <!-- ê²°ê³¼í‘œì‹œ ëª¨ë“ˆ (ê¸°ì¡´ DOM ID ë³´ì¡´) -->
                    <div id="result-display-module">
                        <!-- ì •ë‹µ í‘œì‹œ ì˜ì—­ (ê¸°ì¡´ DOM ID ìœ ì§€) -->
                        <div id="correct-answer" class="hidden mb-6 p-6 bg-gradient-to-r from-green-50 to-emerald-50 
                                                         rounded-lg border-l-4 border-green-500 shadow-lg">
                            <div class="flex items-center mb-4">
                                <div class="flex items-center justify-center w-10 h-10 bg-green-500 rounded-full mr-4">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-green-800">ì •ë‹µ</h3>
                                    <p class="text-sm text-green-600">ì˜¬ë°”ë¥¸ ë‹µì•ˆì…ë‹ˆë‹¤</p>
                                </div>
                            </div>
                            
                            <div id="correct-answer-text" class="text-green-700 font-medium bg-white p-4 rounded border border-green-200">
                                ì •ë‹µ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                            </div>
                        </div>

                        <!-- ê²°ê³¼ í‘œì‹œ ì˜ì—­ (ê¸°ì¡´ DOM ID ìœ ì§€) -->
                        <div id="result-area" class="hidden mb-6">
                            <div id="result-message" class="p-4 rounded-lg font-medium border-l-4">
                                <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë  ê²°ê³¼ ë©”ì‹œì§€ -->
                            </div>
                        </div>
                    </div>

                    <!-- ë„¤ë¹„ê²Œì´ì…˜ ëª¨ë“ˆ (ê¸°ì¡´ í•¨ìˆ˜ëª… ë³´ì¡´) -->
                    <div id="navigation-module">
                        <div class="mt-4 bg-white rounded-lg shadow-lg border border-gray-200 p-4">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <!-- ì´ì „ ë¬¸ì œ ë²„íŠ¼ (ê¸°ì¡´ í•¨ìˆ˜ëª… ìœ ì§€) -->
                                <button onclick="previousQuestion()" 
                                        class="flex items-center justify-center px-6 py-3 bg-gray-500 hover:bg-gray-600 
                                               text-white font-bold rounded-lg transition-all duration-200 transform hover:scale-105 
                                               focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-50 shadow-lg">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                                    </svg>
                                    ì´ì „ ë¬¸ì œ
                                </button>
                                
                                <!-- ì •ë‹µ í™•ì¸ ë²„íŠ¼ (ê¸°ì¡´ í•¨ìˆ˜ëª… ìœ ì§€) -->
                                <button id="check-button" onclick="checkAnswer()" 
                                        class="flex items-center justify-center px-6 py-3 bg-blue-600 hover:bg-blue-700 
                                               text-white font-bold rounded-lg transition-all duration-200 transform hover:scale-105 
                                               focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 shadow-lg">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                    ì •ë‹µ í™•ì¸
                                </button>
                                
                                <!-- ë‹¤ìŒ ë¬¸ì œ ë²„íŠ¼ (ê¸°ì¡´ í•¨ìˆ˜ëª… ìœ ì§€) -->
                                <button onclick="nextQuestion()" 
                                        class="flex items-center justify-center px-6 py-3 bg-green-600 hover:bg-green-700 
                                               text-white font-bold rounded-lg transition-all duration-200 transform hover:scale-105 
                                               focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 shadow-lg">
                                    ë‹¤ìŒ ë¬¸ì œ
                                    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ë‹¨ìˆœí™”ëœ JavaScriptë§Œ ë¡œë“œ -->
    <script src="/static/js/basic_learning_main.js"></script>
    
    <!-- ì¤‘ì•™ ë°ì´í„° ê´€ë¦¬ ì‹œìŠ¤í…œ -->
    <script src="/static/js/central_data_manager.js"></script>
    <script src="/static/js/compatibility_layer.js"></script>
    <script src="/static/js/quiz_data_collector.js"></script>
    <script src="/static/js/realtime_sync_manager.js"></script>
    
    <!-- ê²°ê³¼ í‘œì‹œ ê´€ë¦¬ì (ì •ë‹µí™•ì¸ ê¸°ëŠ¥ í•„ìˆ˜) -->
    <script src="/static/js/result_display_manager.js"></script>
    
    <!-- ë©”ë‰´ ê´€ë ¨ í•¨ìˆ˜ë“¤ -->
    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== ê¸°ë³¸í•™ìŠµ í˜ì´ì§€ ë¡œë“œ ===');
            
            // ì¤‘ì•™ ë°ì´í„° ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ˆê¸°í™” í™•ì¸
            initializeCentralDataSystem();
            
            // ì¹´í…Œê³ ë¦¬ ì •ë³´ í™•ì¸ ë° ì œëª© ì—…ë°ì´íŠ¸
            updateLearningTitle();
            
            // ë ˆì´ì–´ë³„ ì¡°ê±´ë¶€ ë²„íŠ¼ ì—…ë°ì´íŠ¸
            updateNavigationButton();
            
            // URL íŒŒë¼ë¯¸í„° í™•ì¸ (ì´ì–´í’€ê¸°)
            const urlParams = new URLSearchParams(window.location.search);
            const continueMode = urlParams.get('continue');
            const questionIndex = urlParams.get('question');
            
            if (continueMode === 'true' && questionIndex !== null) {
                console.log(`âœ… ì´ì–´í’€ê¸° ëª¨ë“œ: ${parseInt(questionIndex) + 1}ë²ˆ ë¬¸ì œë¶€í„° ì‹œì‘`);
                // ì´ì–´í’€ê¸° ëª¨ë“œë¡œ ë°”ë¡œ ì‹œì‘
                startContinueMode(parseInt(questionIndex));
            } else {
                // ê¸°ë³¸í•™ìŠµ ìë™ ì‹œì‘ (ì´ì „ë¬¸ì œ ì´ì–´í’€ê¸°)
                autoStartBasicLearning();
            }
        });

        // ê¸°ë³¸í•™ìŠµ ìë™ ì‹œì‘ í•¨ìˆ˜
        function autoStartBasicLearning() {
            console.log('ğŸ”„ ê¸°ë³¸í•™ìŠµ ìë™ ì‹œì‘ (ì´ì „ë¬¸ì œ ì´ì–´í’€ê¸°)');
            
            // ì¤‘ì•™ ë°ì´í„°ì—ì„œ ì´ì „ í•™ìŠµ ìƒíƒœ í™•ì¸
            const lastLearningState = getLastLearningState();
            
            if (lastLearningState && lastLearningState.lastQuestionIndex > 0) {
                console.log(`âœ… ì´ì „ í•™ìŠµ ìƒíƒœ ë°œê²¬: ${lastLearningState.lastQuestionIndex + 1}ë²ˆ ë¬¸ì œë¶€í„° ì´ì–´í’€ê¸°`);
                startContinueMode(lastLearningState.lastQuestionIndex);
            } else {
                console.log('ğŸ”„ ì²˜ìŒ ì‹œì‘í•˜ëŠ” ê²½ìš°, 1ë²ˆ ë¬¸ì œë¶€í„° ì‹œì‘');
                // ë°”ë¡œ ë¬¸ì œ ë¡œë”© ì‹œì‘
                startContinueMode(0);
            }
        }

        // ì´ì „ í•™ìŠµ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
        function getLastLearningState() {
            try {
                const realTimeData = JSON.parse(localStorage.getItem('aicu_real_time_data') || '{}');
                const currentCategory = localStorage.getItem('aicu_current_category') || '06ì¬ì‚°ë³´í—˜';
                
                // ê¸°ë³¸í•™ìŠµ ê´€ë ¨ ë°ì´í„° í™•ì¸
                const basicLearningData = realTimeData['basic_learning'] || {};
                
                return {
                    category: currentCategory,
                    lastQuestionIndex: basicLearningData.lastQuestionIndex || 0,
                    totalSolved: basicLearningData.solved || 0,
                    totalCorrect: basicLearningData.correct || 0
                };
            } catch (error) {
                console.error('âŒ ì´ì „ í•™ìŠµ ìƒíƒœ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
                return null;
            }
        }

        // ì¤‘ì•™ ë°ì´í„° ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
        function initializeCentralDataSystem() {
            console.log('=== ì¤‘ì•™ ë°ì´í„° ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ===');
            
            // ì¤‘ì•™ ë°ì´í„° ê´€ë¦¬ì í™•ì¸
            if (window.CentralDataManager) {
                console.log('âœ… CentralDataManager í™•ì¸ë¨');
            } else {
                console.warn('âš ï¸ CentralDataManagerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
            
            // í˜¸í™˜ì„± ë ˆì´ì–´ í™•ì¸
            if (window.CompatibilityLayer) {
                console.log('âœ… CompatibilityLayer í™•ì¸ë¨');
            } else {
                console.warn('âš ï¸ CompatibilityLayerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
            
            // ë¬¸ì œ í’€ì´ ë°ì´í„° ìˆ˜ì§‘ê¸° í™•ì¸
            if (window.QuizDataCollector) {
                console.log('âœ… QuizDataCollector í™•ì¸ë¨');
            } else {
                console.warn('âš ï¸ QuizDataCollectorë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
            
            // ì‹¤ì‹œê°„ ë™ê¸°í™” ë§¤ë‹ˆì € í™•ì¸
            if (window.RealtimeSyncManager) {
                console.log('âœ… RealtimeSyncManager í™•ì¸ë¨');
            } else {
                console.warn('âš ï¸ RealtimeSyncManagerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
            
            console.log('âœ… ì¤‘ì•™ ë°ì´í„° ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // í•™ìŠµ ì œëª© ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateLearningTitle() {
            const urlParams = new URLSearchParams(window.location.search);
            const category = urlParams.get('category');
            
            if (category) {
                const categoryNames = {
                    '06ì¬ì‚°ë³´í—˜': 'ì¬ì‚°ë³´í—˜',
                    '07íŠ¹ì¢…ë³´í—˜': 'íŠ¹ì¢…ë³´í—˜',
                    '08ë°°ìƒì±…ì„ë³´í—˜': 'ë°°ìƒì±…ì„ë³´í—˜',
                    '09í•´ìƒë³´í—˜': 'í•´ìƒë³´í—˜'
                };
                
                const categoryName = categoryNames[category] || category;
                const learningTitle = document.getElementById('learning-title');
                
                if (learningTitle) {
                    learningTitle.textContent = `ëŒ€ë¶„ë¥˜í•™ìŠµ : ${categoryName}`;
                    console.log(`ğŸ“ í•™ìŠµ ì œëª© ì—…ë°ì´íŠ¸: ëŒ€ë¶„ë¥˜í•™ìŠµ : ${categoryName}`);
                }
            }
        }

        // ì´ì–´í’€ê¸° ëª¨ë“œ ì‹œì‘
        function startContinueMode(startIndex) {
            console.log(`ğŸ”„ ì´ì–´í’€ê¸° ì‹œì‘: ${startIndex + 1}ë²ˆ ë¬¸ì œë¶€í„°`);
            
            // ë©”ë‰´ ìˆ¨ê¸°ê³  ë¬¸ì œ ì˜ì—­ í‘œì‹œ
            document.getElementById('mode-selection').classList.add('hidden');
            document.getElementById('basic-question-area').classList.remove('hidden');
            
            // ë ˆì´ì–´ë³„ ì¡°ê±´ë¶€ ë²„íŠ¼ ì—…ë°ì´íŠ¸
            updateNavigationButton();
            
            // ë¬¸ì œ ë¡œë”© ë° í‘œì‹œ
            if (typeof displayQuestion === 'function') {
                // ì „ì—­ ë³€ìˆ˜ ì—…ë°ì´íŠ¸
                if (typeof window.currentQuestionIndex !== 'undefined') {
                    window.currentQuestionIndex = startIndex;
                }
                displayQuestion(startIndex);
            }
        }

        // ê¸°ë³¸í•™ìŠµ ì´ˆê¸°í™”
        function initializeBasicLearning() {
            console.log('ğŸ¯ ê¸°ë³¸í•™ìŠµ ì´ˆê¸°í™”');
            // ê¸°ì¡´ ì´ˆê¸°í™” ë¡œì§ (í•„ìš”ì‹œ ì¶”ê°€)
        }

        // ì´ì „ë¬¸ì œë¡œ ì´ë™
        function previousQuestion() {
            console.log('â¬…ï¸ ì´ì „ë¬¸ì œë¡œ ì´ë™');
            if (typeof window.previousQuestion === 'function') {
                window.previousQuestion();
            } else {
                console.log('âš ï¸ previousQuestion í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
        }
        
        // í™ˆìœ¼ë¡œ ê°€ê¸°
        function goToHome() {
            // í˜„ì¬ ì°½ì—ì„œ í™ˆìœ¼ë¡œ ì´ë™ (ìƒˆ ì°½ ì—´ë¦¼ ë°©ì§€)
            try {
                // ë°©ë²• 1: replace ì‚¬ìš© (ë¸Œë¼ìš°ì € íˆìŠ¤í† ë¦¬ì—ì„œ í˜„ì¬ í˜ì´ì§€ ì œê±°)
                window.location.replace('/');
            } catch (error) {
                // ë°©ë²• 2: assign ì‚¬ìš© (ëŒ€ì²´ ë°©ë²•)
                window.location.assign('/');
            }
        }
        
        // ê¸°ë³¸í•™ìŠµ ë©”ë‰´ë¡œ ê°€ê¸°
        function goToBasicLearningMenu() {
            window.location.href = '/basic-learning';
        }
        
        // ëŒ€ë¶„ë¥˜ ë©”ë‰´ë¡œ ê°€ê¸°
        function goToLargeCategoryMenu() {
            window.location.href = '/large-category-learning';
        }
        
        // ë ˆì´ì–´ë³„ ì¡°ê±´ë¶€ ë²„íŠ¼ ì—…ë°ì´íŠ¸
        function updateNavigationButton() {
            const urlParams = new URLSearchParams(window.location.search);
            const category = urlParams.get('category');
            const isQuestionMode = !document.getElementById('basic-question-area').classList.contains('hidden');
            
            const button = document.getElementById('navigation-button');
            
            if (category) {
                // ëŒ€ë¶„ë¥˜í•™ìŠµ ëª¨ë“œ
                if (isQuestionMode) {
                    // ë ˆì´ì–´2/3 (ë¬¸ì œí’€ì´): ëŒ€ë¶„ë¥˜ë©”ë‰´ë¡œ
                    button.textContent = 'ëŒ€ë¶„ë¥˜ë©”ë‰´ë¡œ';
                    button.onclick = goToLargeCategoryMenu;
                    button.className = 'bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg';
                } else {
                    // ë ˆì´ì–´1 (ëŒ€ë¶„ë¥˜ ì´ˆê¸°): í™ˆìœ¼ë¡œ
                    button.textContent = 'í™ˆìœ¼ë¡œ';
                    button.onclick = goToHome;
                    button.className = 'bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg';
                }
            } else {
                // ê¸°ë³¸í•™ìŠµ ëª¨ë“œ - í•­ìƒ í™ˆìœ¼ë¡œ
                button.textContent = 'í™ˆìœ¼ë¡œ';
                button.onclick = goToHome;
                button.className = 'bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg';
            }
            
            console.log(`ğŸ”„ ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ì—…ë°ì´íŠ¸: ${button.textContent} (${category ? 'ëŒ€ë¶„ë¥˜í•™ìŠµ' : 'ê¸°ë³¸í•™ìŠµ'} ${isQuestionMode ? 'ë ˆì´ì–´2/3' : 'ë ˆì´ì–´1'})`);
        }
        
        // ëª¨ë“œ ì„ íƒ í•¨ìˆ˜ë“¤
        function selectBasicLearningMode(mode) {
            console.log(`ğŸ¯ ê¸°ë³¸í•™ìŠµ ëª¨ë“œ ì„ íƒ: ${mode}`);
            
            // ë©”ë‰´ ìˆ¨ê¸°ê³  ë¬¸ì œ ì˜ì—­ í‘œì‹œ
            document.getElementById('mode-selection').classList.add('hidden');
            document.getElementById('basic-question-area').classList.remove('hidden');
            
            // ë ˆì´ì–´ë³„ ì¡°ê±´ë¶€ ë²„íŠ¼ ì—…ë°ì´íŠ¸
            updateNavigationButton();
            
            // ëª¨ë“œì— ë”°ë¥¸ ì‹œì‘ ì¸ë±ìŠ¤ ì„¤ì •
            let startIndex = 0;
            
            if (mode === 'continue') {
                // ì´ì–´í’€ê¸°: ì¤‘ì•™ ë°ì´í„°ì—ì„œ ì´ì „ í•™ìŠµ ìƒíƒœ í™•ì¸
                const lastLearningState = getLastLearningState();
                if (lastLearningState && lastLearningState.lastQuestionIndex > 0) {
                    startIndex = lastLearningState.lastQuestionIndex;
                    console.log(`ğŸ”„ ì´ì–´í’€ê¸°: ${startIndex + 1}ë²ˆ ë¬¸ì œë¶€í„° ì‹œì‘`);
                } else {
                    startIndex = 0;
                    console.log('ğŸ”„ ì´ì–´í’€ê¸°: ì§„í–‰ìƒí™© ì—†ìŒ, 1ë²ˆ ë¬¸ì œë¶€í„° ì‹œì‘');
                }
            } else if (mode === 'restart') {
                // ì²˜ìŒí’€ê¸°: 0ë²ˆ ë¬¸ì œë¶€í„° ì‹œì‘
                startIndex = 0;
                console.log('ğŸ”„ ì²˜ìŒí’€ê¸°: 1ë²ˆ ë¬¸ì œë¶€í„° ì‹œì‘');
            } else if (mode === 'random') {
                // ëœë¤í’€ê¸°: ë¬´ì‘ìœ„ ë¬¸ì œ ì„ íƒ
                startIndex = Math.floor(Math.random() * 789);
                console.log(`ğŸ² ëœë¤í’€ê¸°: ${startIndex + 1}ë²ˆ ë¬¸ì œë¶€í„° ì‹œì‘`);
            }
            
            // ë¬¸ì œ í’€ì´ ì‹œì‘ ì´ë²¤íŠ¸ ë°œìƒ
            triggerQuizStartEvent(startIndex, mode);
            
            // ë¬¸ì œ ë¡œë”© ë° í‘œì‹œ
            if (typeof displayQuestion === 'function') {
                // ì „ì—­ ë³€ìˆ˜ ì—…ë°ì´íŠ¸
                if (typeof window.currentQuestionIndex !== 'undefined') {
                    window.currentQuestionIndex = startIndex;
                }
                displayQuestion(startIndex);
            }
        }

        // ë¬¸ì œ í’€ì´ ì‹œì‘ ì´ë²¤íŠ¸ ë°œìƒ
        function triggerQuizStartEvent(questionIndex, mode) {
            console.log('=== ë¬¸ì œ í’€ì´ ì‹œì‘ ì´ë²¤íŠ¸ ë°œìƒ ===');
            
            const quizStartData = {
                questionId: `basic_${questionIndex}`,
                category: 'basic_learning',
                mode: mode,
                questionIndex: questionIndex,
                timestamp: new Date().toISOString(),
                pageUrl: window.location.href
            };
            
            // ë¬¸ì œ í’€ì´ ì‹œì‘ ì´ë²¤íŠ¸ ë°œìƒ
            const event = new CustomEvent('quizStarted', {
                detail: quizStartData
            });
            
            document.dispatchEvent(event);
            console.log('âœ… ë¬¸ì œ í’€ì´ ì‹œì‘ ì´ë²¤íŠ¸ ë°œìƒ ì™„ë£Œ:', quizStartData);
        }

        // ë¬¸ì œ í’€ì´ ì™„ë£Œ ë°ì´í„° ìˆ˜ì§‘ í•¨ìˆ˜
        function collectQuizCompletionData(questionId, isCorrect, userAnswer, correctAnswer) {
            console.log('=== ë¬¸ì œ í’€ì´ ì™„ë£Œ ë°ì´í„° ìˆ˜ì§‘ ===');
            
            const quizData = {
                questionId: questionId,
                category: 'basic_learning',
                isCorrect: isCorrect,
                userAnswer: userAnswer,
                correctAnswer: correctAnswer,
                timestamp: new Date().toISOString(),
                pageUrl: window.location.href
            };
            
            // ì¤‘ì•™ ë°ì´í„° ê´€ë¦¬ìë¡œ ì „ì†¡
            if (window.CentralDataManager && typeof window.CentralDataManager.recordQuizResult === 'function') {
                window.CentralDataManager.recordQuizResult(
                    quizData.questionId,
                    quizData.category,
                    quizData.isCorrect,
                    quizData.userAnswer,
                    quizData.correctAnswer
                );
                console.log('âœ… ë¬¸ì œ í’€ì´ ì™„ë£Œ ë°ì´í„° ì¤‘ì•™ ê´€ë¦¬ìë¡œ ì „ì†¡ ì™„ë£Œ');
            } else {
                console.warn('âš ï¸ CentralDataManagerë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
            
            return quizData;
        }
    </script>
    
    <!-- ê³µí†µ ì»´í¬ë„ŒíŠ¸ JavaScript -->
    <script src="/static/js/question_display_manager.js"></script>
    <script src="/static/js/answer_button_manager.js"></script>
    <script src="/static/js/result_display_manager.js"></script>
    <script src="/static/js/basic_learning_main.js"></script>
    <script src="/static/js/central_data_manager.js"></script>
    <script src="/static/js/compatibility_layer.js"></script>
    <script src="/static/js/realtime_sync_manager.js"></script>
    <script src="/static/js/quiz_data_collector.js"></script>
</body>
</html>