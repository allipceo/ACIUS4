#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
AICU Season4 - QuizHandler í•„ë“œëª… ìˆ˜ì •
ì‘ì„±ì: ë…¸íŒ€ì¥
ì‘ì„±ì¼: 2025-08-07
ëª©ì : QuizHandlerì—ì„œ í•„ë“œëª… ë¶ˆì¼ì¹˜ ì˜¤ë¥˜ ìˆ˜ì •
"""

# quiz_handler.pyì—ì„œ ë‹¤ìŒ ë©”ì„œë“œë“¤ì„ ì°¾ì•„ ìˆ˜ì •í•´ ì£¼ì„¸ìš”:

# 1. submit_answer ë©”ì„œë“œì—ì„œ ì •ë‹µ ê°€ì ¸ì˜¤ëŠ” ë¶€ë¶„ ìˆ˜ì •
def submit_answer(self, user_answer: str) -> Dict[str, Any]:
    """
    ë‹µì•ˆ ì œì¶œ ë° ì±„ì 
    
    Args:
        user_answer: ì‚¬ìš©ì ë‹µì•ˆ
        
    Returns:
        Dict: ì±„ì  ê²°ê³¼
    """
    if not self.current_question:
        return {"success": False, "message": "í˜„ì¬ ë¬¸ì œê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."}
    
    if self.is_answered:
        return {"success": False, "message": "ì´ë¯¸ ë‹µë³€í•œ ë¬¸ì œì…ë‹ˆë‹¤."}
    
    # ë‹µì•ˆ ì €ì¥
    self.user_answer = str(user_answer).strip()
    self.is_answered = True
    
    # â­ ì •ë‹µ í™•ì¸ - í•„ë“œëª… ìˆ˜ì • â­
    # ê¸°ì¡´: correct_answer = str(self.current_question.get("ANSWER", "")).strip()
    correct_answer = str(self.current_question.get("answer", "")).strip()  # ì†Œë¬¸ì 'answer'
    
    print(f"ğŸ” QuizHandler ë””ë²„ê·¸:")
    print(f"  í˜„ì¬ ë¬¸ì œ í‚¤: {list(self.current_question.keys())}")
    print(f"  ì •ë‹µ í•„ë“œê°’: '{correct_answer}' (íƒ€ì…: {type(correct_answer)})")
    
    is_correct = self._check_answer(self.user_answer, correct_answer)
    
    # í†µê³„ ì—…ë°ì´íŠ¸
    if is_correct:
        self.total_correct_count += 1
    else:
        self.total_wrong_count += 1
        
    result = {
        "success": True,
        "is_correct": is_correct,
        "user_answer": self.user_answer,
        "correct_answer": correct_answer,
        "question_index": self.current_index,
        "explanation": self._get_explanation()
    }
    
    return result

# 2. _get_answer_type ë©”ì„œë“œì—ì„œ ì •ë‹µ ê°€ì ¸ì˜¤ëŠ” ë¶€ë¶„ ìˆ˜ì • (ìˆë‹¤ë©´)
def _get_answer_type(self, question: Dict) -> str:
    """
    ë¬¸ì œ ìœ í˜• íŒë‹¨ (ì§„ìœ„í˜•/ì„ íƒí˜•)
    
    Args:
        question: ë¬¸ì œ ë°ì´í„°
        
    Returns:
        str: "true_false" ë˜ëŠ” "multiple_choice"
    """
    # â­ í•„ë“œëª… ìˆ˜ì • â­
    # ê¸°ì¡´: answer = str(question.get("ANSWER", "")).strip()
    answer = str(question.get("answer", "")).strip()  # ì†Œë¬¸ì 'answer'
    
    # ì„ íƒí˜• ë¬¸ì œì˜ ê²½ìš°, 'INPUT' í•„ë“œì— 'ì„ íƒí˜•'ì´ë¼ëŠ” ë¬¸ìì—´ì´ í¬í•¨ë˜ì–´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    input_type = str(question.get("input", "")).strip()  # ì†Œë¬¸ì 'input'

    if input_type == 'ì„ íƒí˜•' or answer in ["1", "2", "3", "4", "â‘ ", "â‘¡", "â‘¢", "â‘£"]:
        return "multiple_choice"
    else:
        return "true_false"

# 3. ë‹¤ë¥¸ ë©”ì„œë“œë“¤ì—ì„œë„ ëŒ€ë¬¸ì í•„ë“œëª…ì„ ì†Œë¬¸ìë¡œ ë³€ê²½
# ì˜ˆì‹œ: question.get("QCODE") â†’ question.get("qcode")
#       question.get("QUESTION") â†’ question.get("question")
#       question.get("LAYER1") â†’ question.get("layer1")
#       ë“±ë“±...

print("ğŸ”§ QuizHandler í•„ë“œëª… ìˆ˜ì • ê°€ì´ë“œ:")
print("1. quiz_handler.py íŒŒì¼ì„ ì—´ì–´ì£¼ì„¸ìš”")
print("2. ëª¨ë“  ëŒ€ë¬¸ì í•„ë“œëª…ì„ ì†Œë¬¸ìë¡œ ë³€ê²½í•´ì£¼ì„¸ìš”:")
print("   - ANSWER â†’ answer")
print("   - QCODE â†’ qcode") 
print("   - QUESTION â†’ question")
print("   - LAYER1 â†’ layer1")
print("   - LAYER2 â†’ layer2")
print("   - LAYER3 â†’ layer3")
print("   - INPUT â†’ input")
print("   - ë“±ë“±...")
print("3. íŠ¹íˆ submit_answer ë©”ì„œë“œì˜ ì •ë‹µ ê°€ì ¸ì˜¤ëŠ” ë¶€ë¶„ì´ ì¤‘ìš”í•©ë‹ˆë‹¤!")