#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
AICU Season4 - QuizHandler 필드명 수정
작성자: 노팀장
작성일: 2025-08-07
목적: QuizHandler에서 필드명 불일치 오류 수정
"""

# quiz_handler.py에서 다음 메서드들을 찾아 수정해 주세요:

# 1. submit_answer 메서드에서 정답 가져오는 부분 수정
def submit_answer(self, user_answer: str) -> Dict[str, Any]:
    """
    답안 제출 및 채점
    
    Args:
        user_answer: 사용자 답안
        
    Returns:
        Dict: 채점 결과
    """
    if not self.current_question:
        return {"success": False, "message": "현재 문제가 설정되지 않았습니다."}
    
    if self.is_answered:
        return {"success": False, "message": "이미 답변한 문제입니다."}
    
    # 답안 저장
    self.user_answer = str(user_answer).strip()
    self.is_answered = True
    
    # ⭐ 정답 확인 - 필드명 수정 ⭐
    # 기존: correct_answer = str(self.current_question.get("ANSWER", "")).strip()
    correct_answer = str(self.current_question.get("answer", "")).strip()  # 소문자 'answer'
    
    print(f"🔍 QuizHandler 디버그:")
    print(f"  현재 문제 키: {list(self.current_question.keys())}")
    print(f"  정답 필드값: '{correct_answer}' (타입: {type(correct_answer)})")
    
    is_correct = self._check_answer(self.user_answer, correct_answer)
    
    # 통계 업데이트
    if is_correct:
        self.total_correct_count += 1
    else:
        self.total_wrong_count += 1
        
    result = {
        "success": True,
        "is_correct": is_correct,
        "user_answer": self.user_answer,
        "correct_answer": correct_answer,
        "question_index": self.current_index,
        "explanation": self._get_explanation()
    }
    
    return result

# 2. _get_answer_type 메서드에서 정답 가져오는 부분 수정 (있다면)
def _get_answer_type(self, question: Dict) -> str:
    """
    문제 유형 판단 (진위형/선택형)
    
    Args:
        question: 문제 데이터
        
    Returns:
        str: "true_false" 또는 "multiple_choice"
    """
    # ⭐ 필드명 수정 ⭐
    # 기존: answer = str(question.get("ANSWER", "")).strip()
    answer = str(question.get("answer", "")).strip()  # 소문자 'answer'
    
    # 선택형 문제의 경우, 'INPUT' 필드에 '선택형'이라는 문자열이 포함되어 있을 수 있습니다.
    input_type = str(question.get("input", "")).strip()  # 소문자 'input'

    if input_type == '선택형' or answer in ["1", "2", "3", "4", "①", "②", "③", "④"]:
        return "multiple_choice"
    else:
        return "true_false"

# 3. 다른 메서드들에서도 대문자 필드명을 소문자로 변경
# 예시: question.get("QCODE") → question.get("qcode")
#       question.get("QUESTION") → question.get("question")
#       question.get("LAYER1") → question.get("layer1")
#       등등...

print("🔧 QuizHandler 필드명 수정 가이드:")
print("1. quiz_handler.py 파일을 열어주세요")
print("2. 모든 대문자 필드명을 소문자로 변경해주세요:")
print("   - ANSWER → answer")
print("   - QCODE → qcode") 
print("   - QUESTION → question")
print("   - LAYER1 → layer1")
print("   - LAYER2 → layer2")
print("   - LAYER3 → layer3")
print("   - INPUT → input")
print("   - 등등...")
print("3. 특히 submit_answer 메서드의 정답 가져오는 부분이 중요합니다!")